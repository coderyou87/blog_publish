(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{490:function(a,t,s){"use strict";s.r(t);var e=s(42),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"docker存储原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker存储原理"}},[a._v("#")]),a._v(" Docker存储原理")]),a._v(" "),s("p",[s("strong",[a._v("问题：")]),a._v(" 基于某一个镜像，启动了多个容器，一个容器运行时完整环境有20MB，那么多个容器总共会占用多少存储空间？")]),a._v(" "),s("p",[a._v("镜像的内容是固定不变的，而容器的内容是经常变化的。")]),a._v(" "),s("p",[a._v("Docker在底层使用自己的存储驱动（StorageDriver），来管理自己的文件内容。")]),a._v(" "),s("p",[a._v("Docker支持多种文件存储驱动，在Centos版本的docker中，默认使用的是"),s("code",[a._v("OverlayFS")]),a._v("。其他文件系统还有"),s("code",[a._v("Btrfs")]),a._v("、"),s("code",[a._v("AUFS")]),a._v("。")]),a._v(" "),s("p",[s("strong",[a._v("OverlayFS")])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411142745928",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/1105400a0e36407e81db08d8274b19e5.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/1105400a0e36407e81db08d8274b19e5.png",alt:"image-20210411142745928"}})])]),a._v(" "),s("h2",{attrs:{id:"一、镜像的存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、镜像的存储"}},[a._v("#")]),a._v(" 一、镜像的存储")]),a._v(" "),s("h3",{attrs:{id:"_1-1-镜像的存储结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-镜像的存储结构"}},[a._v("#")]),a._v(" 1.1 镜像的存储结构")]),a._v(" "),s("p",[a._v("查看Nginx镜像的分层："),s("code",[a._v("docker history nginx:latest")])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411125941790",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/67ed4db0124a4efb8480c52c33c73670.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/67ed4db0124a4efb8480c52c33c73670.png",alt:"image-20210411125941790"}})])]),a._v(" "),s("p",[a._v("查看镜像的存储位置："),s("code",[a._v("docker image inspect nginx:latest")])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411130553323",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/fec8c5d812614f0489218e2a7d36ef26.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/fec8c5d812614f0489218e2a7d36ef26.png",alt:"image-20210411130553323"}})])]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"GraphDriver"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Data"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"LowerDir"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/lib/docker/overlay2/a11fcbab9871b5798ea00780fb5e411a1bc93494ca86f4c5002f7a0b0958a7eb/diff:/var/lib/docker/overlay2/ee5a5024443cc8e6caf62d182b36463be9e56103340af75560667a062bedcd58/diff:/var/lib/docker/overlay2/3974c07d90d9f9e8bf8c522b99a9ea0777610a30951a9793ce7302b72ac2181c/diff:/var/lib/docker/overlay2/ad9a87c70f97c94c68e409f5b353e1a5af6eedf33959422bef0028c5c9883dfe/diff:/var/lib/docker/overlay2/68601c5f3148936c1cefd26cf5dcce6b7a752257418f7bba62513ffb9b5cab62/diff"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"MergedDir"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/lib/docker/overlay2/c940bc449b99fa77a57ba47b9bf0684e4c934550c701c712e4fafa429d4ce744/merged"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"UpperDir"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/lib/docker/overlay2/c940bc449b99fa77a57ba47b9bf0684e4c934550c701c712e4fafa429d4ce744/diff"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"WorkDir"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/lib/docker/overlay2/c940bc449b99fa77a57ba47b9bf0684e4c934550c701c712e4fafa429d4ce744/work"')]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"overlay2"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("ul",[s("li",[s("p",[s("code",[a._v("LowerDir")]),a._v("（底层目录）：（倒着看）")]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[a._v("/var/lib/docker/overlay"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v("fcbab"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9871")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5798")]),a._v("ea"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("00780")]),a._v("fb"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5e411")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("bc"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("93494")]),a._v("ca"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("86")]),a._v("f"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5002")]),a._v("f"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0958")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("eb/diff"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n")])])]),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411131937697",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/332e7e6e23bf4e5b833a5a347c856de2.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/332e7e6e23bf4e5b833a5a347c856de2.png",alt:"image-20210411131937697"}})])]),a._v(" "),s("p",[s("strong",[a._v("存储用户文件")])]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[a._v("/var/lib/docker/overlay"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/ee"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5024443")]),a._v("cc"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8e6")]),a._v("caf"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("62")]),a._v("d"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("182")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("36463")]),a._v("be"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9e56103340")]),a._v("af"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("75560667")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("062")]),a._v("bedcd"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("58")]),a._v("/diff"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n")])])]),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411131627096",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/f04f322dd86145468506665f72a874bb.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/f04f322dd86145468506665f72a874bb.png",alt:"image-20210411131627096"}})])]),a._v(" "),s("p",[s("strong",[a._v("存储Nginx的启动命令")])]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[a._v("/var/lib/docker/overlay"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3974")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("07")]),a._v("d"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("90")]),a._v("d"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v("f"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9e8")]),a._v("bf"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("522")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("99")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v("ea"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0777610")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30951")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9793")]),a._v("ce"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7302")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("72")]),a._v("ac"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v("c/diff"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n")])])]),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411131517290",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/5cf7c4c5e2e944318716780659daa562.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/5cf7c4c5e2e944318716780659daa562.png",alt:"image-20210411131517290"}})])]),a._v(" "),s("p",[s("strong",[a._v("存储配置信息")]),a._v("（nginx的默认配置文件存储在这里）")]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[a._v("/var/lib/docker/overlay"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/ad"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("87")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("70")]),a._v("f"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("97")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("94")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("68e409")]),a._v("f"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("353e1")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("af"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v("eedf"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("33959422")]),a._v("bef"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0028")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9883")]),a._v("dfe/diff"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n")])])]),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411131337076",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/0576eb6d08eb45eb8a3376a395c24cf3.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/0576eb6d08eb45eb8a3376a395c24cf3.png",alt:"image-20210411131337076"}})])]),a._v(" "),s("p",[s("strong",[a._v("存储着一个小型的Linux系统")])]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[a._v("/var/lib/docker/overlay"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("68601")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("f"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3148936")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("cefd"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("26")]),a._v("cf"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("dcce"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("752257418")]),a._v("f"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("bba"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("62513")]),a._v("ffb"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("cab"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("62")]),a._v("/diff"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" \n")])])]),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411131250147",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/9596757501d64ff48d0579ac15f33507.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/9596757501d64ff48d0579ac15f33507.png",alt:"image-20210411131250147"}})])])]),a._v(" "),s("li",[s("p",[s("code",[a._v("MergedDir")]),a._v("（合并目录）：在OverLayFS中，镜像的合并层没有什么具体含义")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("UpperDir")]),a._v("（上层目录）：在OverLayFS中，镜像的上册目录没有什么具体含义")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("WorkDir")]),a._v("（工作目录）：存储临时内容")])])]),a._v(" "),s("p",[a._v("Docker镜像由一系列层组成。每层代表DockerFile中的一条指令。除了最后一层外，其余每一层都是只读的。")]),a._v(" "),s("p",[a._v("DockerFile文件：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("FROM ubuntu:15.04 \nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" /app \nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" /app \nCMD python /app/app.py \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 每一个指令都可能会引起镜像改变，这些改变类似git的方式逐层叠加。")]),a._v("\n")])])]),s("blockquote",[s("ul",[s("li",[a._v("该DockerFile文件包含四个命令，每个命令会创建一个层")]),a._v(" "),s("li",[a._v("FROM语句会创建一个基础层")]),a._v(" "),s("li",[a._v("COPY命令会将宿主机上的文件复制到镜像中")]),a._v(" "),s("li",[a._v("RUN，会在构建镜像时，执行指定的命令")]),a._v(" "),s("li",[a._v("CMD，指定要在容器中运行的命令")]),a._v(" "),s("li",[a._v("这些层会逐层堆叠")]),a._v(" "),s("li",[a._v("创建新容器时，可以在基础层之上添加一个新的可写层，该层通常被称为“容器层”，对运行中的容器进行的左右更改操作（增删文件等），都会在容器层进行。")])])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411145145504",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/9a6a84f247984a8c89bad5193f4092fd.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/9a6a84f247984a8c89bad5193f4092fd.png",alt:"image-20210411145145504"}})])]),a._v(" "),s("h3",{attrs:{id:"_1-2-容器的存储结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-容器的存储结构"}},[a._v("#")]),a._v(" 1.2 容器的存储结构")]),a._v(" "),s("p",[s("strong",[a._v("镜像与容器的存储关系")])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411145230069",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/de68fb8e5e6442888d7186e3c143d51f.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/de68fb8e5e6442888d7186e3c143d51f.png",alt:"image-20210411145230069"}})])]),a._v(" "),s("blockquote",[s("ul",[s("li",[s("p",[a._v("容器和镜像之间的主要区别是可写顶层（容器层，在OverLayFS叫做UpperDir）")])]),a._v(" "),s("li",[s("p",[a._v("在容器中添加新数据或修改现有数据的所有操作都在容器层进行")])]),a._v(" "),s("li",[s("p",[a._v("删除容器后，容器层也会被删除，但是基础层（镜像层）保持不变。因为每个容器都有其自己的可写容器层，并且所有更改都存储在该容器层中，所以多个容器可以共享对同一镜像的访问，但是具有自己的数据状态。")])])])]),a._v(" "),s("p",[s("strong",[a._v("容器的存储结构与镜像类似")])]),a._v(" "),s("p",[s("code",[a._v("docker inspect 3924f1d38c8b")])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411141721889",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/3e04aa0f034c4cdf89eb41eaf3ba8c07.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/3e04aa0f034c4cdf89eb41eaf3ba8c07.png",alt:"image-20210411141721889"}})])]),a._v(" "),s("p",[a._v("上面是一个"),s("code",[a._v("nginx")]),a._v("容器的存储结构，如果修改nginx的配置文件，会反映到"),s("code",[a._v("MergedDir")]),a._v("和"),s("code",[a._v("UpperDir")]),a._v("目录中对应的文件。而"),s("code",[a._v("LowerDir")]),a._v("中对应的文件则不会被修改。")]),a._v(" "),s("p",[a._v("合并层（MergedDir）是一个映射层，并不会真实存储数据，只是映射镜像层（Image layer）和容器层（Container layer）的文件。")]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411142745928",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/1105400a0e36407e81db08d8274b19e5.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/1105400a0e36407e81db08d8274b19e5.png",alt:"image-20210411142745928"}})])]),a._v(" "),s("h3",{attrs:{id:"_1-5-磁盘容量预估"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-磁盘容量预估"}},[a._v("#")]),a._v(" 1.5 磁盘容量预估")]),a._v(" "),s("h3",{attrs:{id:"_1-6-镜像如何挑选"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-镜像如何挑选"}},[a._v("#")]),a._v(" 1.6 镜像如何挑选")]),a._v(" "),s("h3",{attrs:{id:"_1-7-docker写时复制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-docker写时复制"}},[a._v("#")]),a._v(" 1.7 Docker写时复制")]),a._v(" "),s("ul",[s("li",[a._v("写时复制是一种共享和复制文件的策略，可以最大程度地提高效率")]),a._v(" "),s("li",[a._v("如果文件或目录位于映像的较低层中，而另一层（包括可写层）需要对其进行"),s("strong",[a._v("读取")]),a._v("访问，则它仅使用现有文件。")]),a._v(" "),s("li",[a._v("如果某一层需要修改底层的文件时（在构建镜像或运行容器时），将文件复制到该层并进行修改。这样可以将I/O和每个后续层的大小最小化。")]),a._v(" "),s("li",[a._v("例如："),s("strong",[a._v("当nginx容器已经在运行时，修改Nginx的配置文件，并不会修改到镜像中的nginx.conf文件，而是将nginx.conf文件，复制到容器中，然后进行修改。容器在查找文件时，如果容器中已经存在nginx.conf文件，则使用容器中的文件；如果没有找到，则向下查找镜像中的文件。")]),a._v(" 修改后的配置文件，可以在容器的UpperDir中看到")]),a._v(" "),s("li",[s("strong",[a._v("无论容器中的文件数据如何改变，底层镜像中的文件数据始终不会改变。")])])]),a._v(" "),s("h2",{attrs:{id:"二、容器如何挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、容器如何挂载"}},[a._v("#")]),a._v(" 二、容器如何挂载")]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411150113074",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/6054c9ef3fa349518537ec3e722cbc6c.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/6054c9ef3fa349518537ec3e722cbc6c.png",alt:"image-20210411150113074"}})])]),a._v(" "),s("p",[a._v("docker容器的挂载方式，有三种：")]),a._v(" "),s("ol",[s("li",[s("strong",[a._v("Volumes（卷）")]),a._v("：存储在主机文件系统的一部分中，该文件系统由Docker管理（在Linux上是“"),s("code",[a._v("/var/ lib/docker/volume /")]),a._v("”）。 非Docker进程不应修改文件系统的这一部分。 卷是在Docker中持久存储数据的最佳方法。")]),a._v(" "),s("li",[s("strong",[a._v("Bind mounts(绑定挂载)")]),a._v("  ：可以在任何地方 存储在主机系统上。 它们甚至可能是重要的系统文件或目录。 Docker主机或Docker容器上的非Docker进程可以随时对其进行修改。")]),a._v(" "),s("li",[s("strong",[a._v("tmpfs mounts(临时挂载)")]),a._v("  ：仅存储在主机系统的内存中，并且永远不会写入主机系统的文件系统")])]),a._v(" "),s("h3",{attrs:{id:"_2-1-卷（volumn）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-卷（volumn）"}},[a._v("#")]),a._v(" 2.1 卷（Volumn）")]),a._v(" "),s("p",[a._v("挂载与绑定：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("-v 宿主机路径:容器内绝对路径\n")])])]),s("p",[a._v("如果宿主机路径是绝对路径，叫挂载")]),a._v(" "),s("p",[a._v("如果宿主机路径不是绝对路径，叫绑定，此时docker会自动管理文件内容，不会将此路径当成路径，而是当成卷")]),a._v(" "),s("p",[s("strong",[a._v("如果宿主机路径是绝对路径，会出现空挂载")]),a._v("，如果没有特殊的挂载需求，则使用卷绑定")]),a._v(" "),s("p",[a._v("宿主机路径如果使用绝对路径，则宿主机路径下的文件将被映射到容器内")]),a._v(" "),s("p",[a._v("如果使用卷，则将容器中的文件数据映射到卷中")]),a._v(" "),s("p",[a._v("空挂载：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker run -d -P --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mynginx2 -v /opt/module/docker/nginx:/etc/nginx nginx\n")])])]),s("ul",[s("li",[s("p",[s("strong",[a._v("匿名卷使用")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker run -d -P --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mynginx2 -v /etc/nginx nginx\n")])])]),s("p",[s("code",[a._v("docker")]),a._v("将创建匿名卷，并将容器中的"),s("code",[a._v("/etc/nginx")]),a._v("下的内容保存到卷里")]),a._v(" "),s("p",[a._v("查看容器详情：`docker inspect")]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Mounts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"volume"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"34883fd9884275c34838858267edf6af606395042736396b8d0c6ff5b9da3d87"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Source"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/lib/docker/volumes/34883fd9884275c34838858267edf6af606395042736396b8d0c6ff5b9da3d87/_data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Destination"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/etc/nginx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Driver"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"local"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Mode"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"RW"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Propagation"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411161811311",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/6bca75ee3f0c468583ab3f3286fdd42f.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/6bca75ee3f0c468583ab3f3286fdd42f.png",alt:"image-20210411161811311"}})])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411161830482",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/ad394382b7f14b8980e90b0f4e7136c4.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/ad394382b7f14b8980e90b0f4e7136c4.png",alt:"image-20210411161830482"}})])]),a._v(" "),s("p",[a._v("在路径"),s("code",[a._v("/var/lib/docker/volumes/34883fd9884275c34838858267edf6af606395042736396b8d0c6ff5b9da3d87/_data")]),a._v("下，保存了映射出来的文件数据")]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411162358188",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/460c2cb5c0fe44bd81f787b2a42017f2.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/460c2cb5c0fe44bd81f787b2a42017f2.png",alt:"image-20210411162358188"}})])])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("具名卷使用")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker run -d -P --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mynginx3 -v nginx:/etc/nginx nginx\n")])])]),s("p",[a._v("docker将创建具名卷nginx，并将容器中的"),s("code",[a._v("/etc/nginx")]),a._v("下的内容保存到卷里")]),a._v(" "),s("p",[a._v("查看容器卷："),s("code",[a._v("docker volume ls")])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411160605684",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/b1b9c5546a244de885ecc9511874c911.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/b1b9c5546a244de885ecc9511874c911.png",alt:"image-20210411160605684"}})])]),a._v(" "),s("p",[a._v("查看卷的具体信息：")]),a._v(" "),s("p",[s("code",[a._v("docker volume inspect nginx")])]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"CreatedAt"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2021-04-11T16:05:19+08:00"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Driver"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"local"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Labels"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token null keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Mountpoint"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/lib/docker/volumes/nginx/_data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nginx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Options"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token null keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Scope"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"local"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("p",[a._v("查看容器具体信息 "),s("code",[a._v("docker inspect mynginx3")])]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Mounts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"volume"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nginx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Source"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/lib/docker/volumes/nginx/_data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Destination"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/etc/nginx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Driver"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"local"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Mode"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"z"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"RW"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"Propagation"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[s("code",[a._v("Source")]),a._v("：宿主机目录")]),a._v(" "),s("p",[s("code",[a._v("Destination")]),a._v("：容器内目录")]),a._v(" "),s("p",[s("code",[a._v("/var/lib/docker/volumes/nginx/_data")]),a._v("下的文件")]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411161232959",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/923de84e1aa94a148d23c4326834ee1f.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/923de84e1aa94a148d23c4326834ee1f.png",alt:"image-20210411161232959"}})])]),a._v(" "),s("p",[s("code",[a._v("docker volume")]),a._v("可以操作"),s("code",[a._v("docker")]),a._v("中的"),s("code",[a._v("volume")])]),a._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"image-20210411161406812",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/08958a0dda94478480adad8ecc230e25.png"}},[s("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-11/08958a0dda94478480adad8ecc230e25.png",alt:"image-20210411161406812"}})])])])]),a._v(" "),s("h3",{attrs:{id:"_2-2-bind-mount"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-bind-mount"}},[a._v("#")]),a._v(" 2.2 bind mount")]),a._v(" "),s("h2",{attrs:{id:"三、管理卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、管理卷"}},[a._v("#")]),a._v(" 三、管理卷")]),a._v(" "),s("h3",{attrs:{id:"四、docker-cp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、docker-cp"}},[a._v("#")]),a._v(" 四、Docker CP")])])}),[],!1,null,null,null);t.default=r.exports}}]);