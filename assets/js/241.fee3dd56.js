(window.webpackJsonp=window.webpackJsonp||[]).push([[241],{671:function(a,s,t){"use strict";t.r(s);var e=t(42),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"搭建harbor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建harbor"}},[a._v("#")]),a._v(" 搭建HarBor")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("安装docker")])]),a._v(" "),t("li",[t("p",[a._v("配置/etc/docker/deamon.json文件")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" \n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://im0s841i.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://hub.atguigu.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("添加 "),t("code",[a._v('"insecure-registries": ["https://hub.atguigu.com"]')])])]),a._v(" "),t("li",[t("p",[a._v("修改 /etc/hosts 文件")]),a._v(" "),t("p",[a._v("添加ip映射")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".76.7 hub.atguigu.com\n")])])])]),a._v(" "),t("li",[t("p",[a._v("上传HarBor的安装包到/opt/software目录下")]),a._v(" "),t("p",[a._v("oss下载地址：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("https://you-software.oss-cn-chengdu.aliyuncs.com/harbor/harbor-offline-installer-v1.2.0.tgz\n")])])])]),a._v(" "),t("li",[t("p",[a._v("解压")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -zxvf harbor-offline-installer-v1.2.0.tgz -C /opt/module/\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/harbor/\n")])])])]),a._v(" "),t("li",[t("p",[a._v("修改配置文件")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" harbor.cfg\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("hostname")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" hub.atguigu.com\nui_url_protocol "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" https\nssl_cert "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /opt/module/harbor/cert/server.crt\nssl_cert_key "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /opt/module/harbor/cert/server.key\n")])])])]),a._v(" "),t("li",[t("p",[a._v("创建文件夹")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /opt/module/harbor/cert\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/harbor/cert\n")])])])]),a._v(" "),t("li",[t("p",[a._v("创建https证书以及配置相关权限")]),a._v(" "),t("p",[a._v("这一步需要设置一个密码，需要记住")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("openssl genrsa -des3 -out server.key "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("openssl req -new -key server.key -out server.csr\n")])])]),t("p",[t("a",{attrs:{"data-fancybox":"",title:"image-20201116233032611",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-16/dfc0fc1f62c94a6d86e041200974bddb.png"}},[t("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-16/dfc0fc1f62c94a6d86e041200974bddb.png",alt:"image-20201116233032611"}})])]),a._v(" "),t("p",[a._v("输入一些基本信息后，在challenge password时，直接输入两个回车")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" server.key server.key.org\nopenssl rsa -in server.key.org -out server.key\nopenssl x509 -req -days "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("365")]),a._v(" -in server.csr -signkey server.key -out server.crt\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" -R "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("777")]),a._v(" /opt/module/harbor/cert\n")])])])]),a._v(" "),t("li",[t("p",[a._v("安装harbor")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/harbor\n./install.sh\n")])])])]),a._v(" "),t("li",[t("p",[a._v("检测")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("页面访问")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("http://192.168.76.7\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("admin\nHarbor12345\n")])])]),t("p",[a._v("admin的密码可以在/opt/module/harbor/harbor.cfg中修改")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("harbor_admin_password "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Harbor12345\n")])])])]),a._v(" "),t("li",[t("p",[a._v("在其他节点访问该私有仓库")]),a._v(" "),t("p",[a._v("修改配置文件/etc/docker/deamon.json")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" \n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://im0s841i.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://hub.atguigu.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("配置/etc/hosts文件，添加以下内容")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("192.168.76.7 hub.atguigu.com\n")])])]),t("p",[a._v("重启docker")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("systemctl restart docker\n")])])]),t("p",[a._v("登陆")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker login hub.atguigu.com\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("admin\nHarbor12345\n")])])]),t("p",[a._v("从公网下载镜像并推送到私有仓库")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker pull nginx\ndocker tag nginx:latest hub.atguigu.com/library/mynginx:latest\ndocker push hub.atguigu.com/library/mynginx:latest\n")])])]),t("p",[a._v("使用k8s启动集群")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kubectl run nginx-deployment --image=hub.atguigu.com/library/mynginx:latest --port=80 --replicas=3\n")])])]),t("p",[a._v("测试")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kubectl get pod -o wide\n")])])]),t("p",[t("a",{attrs:{"data-fancybox":"",title:"image-20201116234251210",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-16/4486d8b98280453986ad189ea47e7758.png"}},[t("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-16/4486d8b98280453986ad189ea47e7758.png",alt:"image-20201116234251210"}})])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.244")]),a._v(".2.2\n")])])]),t("p",[a._v("修改svc，让外部可以访问，将type的值修改为NodePort")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl edit svc nginx-deployment\n")])])]),t("p",[t("a",{attrs:{"data-fancybox":"",title:"image-20201116234430393",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-16/75b97de7464549908563bd42e73b9f2d.png"}},[t("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-16/75b97de7464549908563bd42e73b9f2d.png",alt:"image-20201116234430393"}})])]),a._v(" "),t("p",[a._v("查看对外的端口")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl get svc\n")])])]),t("p",[t("a",{attrs:{"data-fancybox":"",title:"image-20201116234549393",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-16/99627dfbf1714d7082f9a6503068768f.png"}},[t("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-16/99627dfbf1714d7082f9a6503068768f.png",alt:"image-20201116234549393"}})])]),a._v(" "),t("p",[a._v("在页面上访问：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".76.8:30720\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".76.9:30720\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".76.10:30720\n")])])]),t("p",[a._v("以上ip是k8s集群的ip地址")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);