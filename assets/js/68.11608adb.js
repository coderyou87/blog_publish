(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{539:function(s,a,e){"use strict";e.r(a);var t=e(52),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"mysql主从复制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql主从复制"}},[s._v("#")]),s._v(" MySqL主从复制")]),s._v(" "),e("h2",{attrs:{id:"一、主机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、主机"}},[s._v("#")]),s._v(" 一、主机")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("安装"),e("code",[s._v("MySQL")])])]),s._v(" "),e("li",[e("p",[s._v("配置"),e("code",[s._v("MySQL")])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[client]\nport=3306\n[mysqld]\nport=3306\nbasedir=/opt/module/mysql-5.7.25-el7-x86_64\ndatadir=/opt/module/mysql-5.7.25-el7-x86_64/data\ncharacter-set-server=utf8\ndefault_storage_engine=InnoDB\nsql_mode=STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\nlog-error=/opt/module/mysql-5.7.25-el7-x86_64/log/error.log\n# 开启日志\nlog-bin=mysql-bin\n# 服务Id，主从机不能相同\nserver-id=1\n# 设置需要同步的数据库\nbinlog-do-db=test_sharing_0\n# 屏蔽系统库同步\nbinlog-ignore-db=mysql\nbinlog-ignore-db=information_schema\nbinlog-ignore-db=performance_schema\n")])])])]),s._v(" "),e("li",[e("p",[s._v("启动并进入"),e("code",[s._v("MySQL")])])]),s._v(" "),e("li",[e("p",[s._v("授权主从复制专用账号")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("grant replication slave on *.* to "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db_sync'")]),s._v("@"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),e("li",[e("p",[s._v("查看主机位点信息")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("show master status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),e("h2",{attrs:{id:"二、从机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、从机"}},[s._v("#")]),s._v(" 二、从机")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("安装"),e("code",[s._v("MySQL")])])]),s._v(" "),e("li",[e("p",[s._v("配置（"),e("code",[s._v("/etc/my.cnf")]),s._v("）")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[client]\nport=3306\n[mysqld]\nport=3306\nbasedir=/opt/module/mysql-5.7.25-el7-x86_64\ndatadir=/opt/module/mysql-5.7.25-el7-x86_64/data\ncharacter-set-server=utf8\ndefault_storage_engine=InnoDB\nsql_mode=STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\n# 开启日志\nlog-bin=mysql-bin\n# 服务Id，与主机不能相同\nserver-id=2\n# 设置需要同步的数据库\nreplicate_wild_do_table=test_sharing_0.%\n# 屏蔽系统库同步\nreplicate_wild_ignore_table=mysql.%\nreplicate_wild_ignore_table=information_schema.%\nreplicate_wild_ignore_table=performance_schema.%\n# 启动常规日志记录\ngeneral_log=on\ngeneral_log_file=/opt/module/mysql-5.7.25-el7-x86_64/log/mysql.log\n# 记录错误日志\nlog-error=/opt/module/mysql-5.7.25-el7-x86_64/log/error.log\n# 延迟日志\nrelay-log=localhost-relay-bin\n")])])])]),s._v(" "),e("li",[e("p",[s._v("启动并进入"),e("code",[s._v("MySQL")])])]),s._v(" "),e("li",[e("p",[s._v("配置从库，指向主库")]),s._v(" "),e("p",[e("code",[s._v("master_host")]),s._v("：主库的Id地址")]),s._v(" "),e("p",[e("code",[s._v("master_user")]),s._v("：主库用于主从复制的账号")]),s._v(" "),e("p",[e("code",[s._v("master_password")]),s._v("：主库用户主从复制账号的密码")]),s._v(" "),e("p",[e("code",[s._v("master_log_file")]),s._v("：主库的日志文件（通过show master status查看）")]),s._v(" "),e("p",[e("code",[s._v("master_log_pos")]),s._v("：主库同步的位点（通过show master status查看）")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("stop slave"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nchange master to\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_host")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.*.*'")]),s._v(",\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_user")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'XXXX'")]),s._v(",\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_password")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'XXX'")]),s._v(",\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_log_file")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'XXX'")]),s._v(",\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_log_pos")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nstart slave"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),e("li",[e("p",[s._v("查看从库状态")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("show slave status "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("G\n")])])]),e("p",[s._v("如果"),e("code",[s._v("Slave_IO_Running")]),s._v("或"),e("code",[s._v("Slave_SQL_Running")]),s._v("中有一项为"),e("code",[s._v("No")]),s._v("，则主从同步配置失败，需要检查。必须两项都未"),e("code",[s._v("YES")]),s._v("，才可能同步成功。")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);