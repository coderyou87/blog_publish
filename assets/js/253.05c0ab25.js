(window.webpackJsonp=window.webpackJsonp||[]).push([[253],{658:function(t,a,e){"use strict";e.r(a);var s=e(42),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"k8s错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s错误"}},[t._v("#")]),t._v(" K8S错误")]),t._v(" "),e("h2",{attrs:{id:"一、error-writing-crisocket-information-for-the-control-plane-node"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、error-writing-crisocket-information-for-the-control-plane-node"}},[t._v("#")]),t._v(" 一、Error writing Crisocket information for the control-plane node")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("error execution phase upload-config/kubelet: Error writing Crisocket information for the control-plane node: timed out waiting for the condition\n")])])]),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("swapoff -a "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" kubeadm reset  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl daemon-reload "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl restart kubelet  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -F "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -t nat -F "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -t mangle -F "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -X\n")])])]),e("h2",{attrs:{id:"二、please-drain-this-node-and-delete-the-cpu-manager-checkpoint-file"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、please-drain-this-node-and-delete-the-cpu-manager-checkpoint-file"}},[t._v("#")]),t._v(" 二、Please drain this node and delete the CPU manager checkpoint file")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(' kubelet: Please drain this node and delete the CPU manager checkpoint file "/var/lib/kubelet/cpu_manager_state" before restarting Kubelet\n')])])]),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf  /var/lib/kubelet/cpu_manager_state\n")])])]),e("h2",{attrs:{id:"三、the-connection-to-the-server-localhost-8080-was-refused"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、the-connection-to-the-server-localhost-8080-was-refused"}},[t._v("#")]),t._v(" 三、The connection to the server localhost:8080 was refused")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("kubectl get node\n")])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("The connection to the server localhost:8080 was refused - did you specify the right host or port?\n")])])]),e("p",[t._v("编辑 /etc/profile文件，追加以下内容")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("KUBECONFIG")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/admin.conf\n")])])]),e("p",[t._v("刷新配置文件")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /etc/profile\n")])])]),e("h2",{attrs:{id:"四、flannel安装失败，一直显示init-imagepullbackoff"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、flannel安装失败，一直显示init-imagepullbackoff"}},[t._v("#")]),t._v(" 四、flannel安装失败，一直显示Init:ImagePullBackOff")]),t._v(" "),e("p",[t._v("flannel安装失败，一直显示Init:ImagePullBackOff")]),t._v(" "),e("p",[t._v("在github下载docker镜像，地址：https://github.com/coreos/flannel/releases")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("wget https://g.ioiox.com/https://github.com/coreos/flannel/releases/download/v0.13.0/flanneld-v0.13.0-amd64.docker\n")])])]),e("p",[e("a",{attrs:{"data-fancybox":"",title:"image-20201115231600261",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-15/15ecf27e3ed64f2b8c70190650779477.png"}},[e("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-15/15ecf27e3ed64f2b8c70190650779477.png",alt:"image-20201115231600261"}})])]),t._v(" "),e("p",[t._v("将镜像导入docker中")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("docker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" flanneld-v0.13.0-amd64.docker\n")])])]),e("p",[e("a",{attrs:{"data-fancybox":"",title:"image-20201115231959659",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-15/bfaa68cae5984af68d1354d8bd1fa4b0.png"}},[e("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-15/bfaa68cae5984af68d1354d8bd1fa4b0.png",alt:"image-20201115231959659"}})])]),t._v(" "),e("p",[t._v("修改文件kube-flannel.yml，修改之前先备份")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" kube-flannel.yml kube-flannel.yml_back\n")])])]),e("p",[e("a",{attrs:{"data-fancybox":"",title:"image-20201115231931696",href:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-15/d5d74706d5b84b638575da3f7910ac61.png"}},[e("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2020-11-15/d5d74706d5b84b638575da3f7910ac61.png",alt:"image-20201115231931696"}})])]),t._v(" "),e("p",[t._v("再次加载文件")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("kubectl apply -f kube-flannel.yml\n")])])]),e("p",[t._v("查询节点状态")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("kubectl get pod -n kube-system\n")])])]),e("h2",{attrs:{id:"五、kubeadm-join-失败"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、kubeadm-join-失败"}},[t._v("#")]),t._v(" 五、kubeadm join 失败")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-node02 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm join 192.168.76.6:6443 --token b9ov87.cn3uyf3nd4s1mh1s         --discovery-token-ca-cert-hash sha256:7ebc5d0c713c5d90f6f12a1808da157047c16d3786b762f5857944bcab83fcce ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING IsDockerSystemdCheck"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": detected "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cgroupfs"')]),t._v(" as the Docker cgroup driver. The recommended driver is "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemd"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" Please follow the guide at https://kubernetes.io/docs/setup/cri/\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Reading configuration from the cluster"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FYI: You can "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at this config "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl -n kube-system get cm kubeadm-config -o yaml'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting the kubelet\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to perform the TLS Bootstrap"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-check"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Initial "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),t._v(" of 40s passed.\nerror execution phase kubelet-start: error uploading crisocket: timed out waiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the condition\nTo see the stack trace of this error execute with --v"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" or higher\n")])])]),e("p",[e("img",{attrs:{src:"http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-04-30/cb9d1f929d9f47c78b2ffe21b7577258.png",alt:"image-20210430230345330"}})]),t._v(" "),e("p",[t._v("解决方法：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("swapoff -a\nkubeadm reset\nsystemctl daemon-reload\nsystemctl restart kubelet\niptables -F "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -t nat -F "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -t mangle -F "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -X  \n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);