<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>虚拟机栈 | coder</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon1" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-02-18/d687f535b564447e82a3178a4e9b2f8c.jpg">
    <link rel="icon2" href="https://you-blog.oss-cn-shenzhen.aliyuncs.com/typora/2021-02-18/icon.jpg">
    <script src="/blog_publish/css/jquery.slim.min.js"></script>
    <script src="/blog_publish/css/jquery.fancybox.min.js"></script>
    <script src="/blog_publish/css/pwd.js"></script>
    <link rel="stylesheet" type="text/css" href="/blog_publish/css/jquery.fancybox.min.css">
    <meta name="description" content="知行合一">
    <link rel="preload" href="/blog_publish/assets/css/0.styles.9a82886c.css" as="style"><link rel="preload" href="/blog_publish/assets/js/app.5e766715.js" as="script"><link rel="preload" href="/blog_publish/assets/js/2.92f2819f.js" as="script"><link rel="preload" href="/blog_publish/assets/js/33.0eeacbf9.js" as="script"><link rel="prefetch" href="/blog_publish/assets/js/10.4b76a04f.js"><link rel="prefetch" href="/blog_publish/assets/js/100.9b202553.js"><link rel="prefetch" href="/blog_publish/assets/js/101.25da26dd.js"><link rel="prefetch" href="/blog_publish/assets/js/102.ee6ef41c.js"><link rel="prefetch" href="/blog_publish/assets/js/103.25a2781d.js"><link rel="prefetch" href="/blog_publish/assets/js/104.26ef551b.js"><link rel="prefetch" href="/blog_publish/assets/js/105.f082b9af.js"><link rel="prefetch" href="/blog_publish/assets/js/106.8c52dcb3.js"><link rel="prefetch" href="/blog_publish/assets/js/107.c133cba6.js"><link rel="prefetch" href="/blog_publish/assets/js/108.0a02576a.js"><link rel="prefetch" href="/blog_publish/assets/js/109.63cc12c7.js"><link rel="prefetch" href="/blog_publish/assets/js/11.dece430d.js"><link rel="prefetch" href="/blog_publish/assets/js/110.b4fd3c5a.js"><link rel="prefetch" href="/blog_publish/assets/js/111.68faa9e4.js"><link rel="prefetch" href="/blog_publish/assets/js/112.c5700ce0.js"><link rel="prefetch" href="/blog_publish/assets/js/113.0a97da97.js"><link rel="prefetch" href="/blog_publish/assets/js/114.c607e5c3.js"><link rel="prefetch" href="/blog_publish/assets/js/115.aa4e5a63.js"><link rel="prefetch" href="/blog_publish/assets/js/116.dd05321e.js"><link rel="prefetch" href="/blog_publish/assets/js/117.d925e4dc.js"><link rel="prefetch" href="/blog_publish/assets/js/118.a11169bf.js"><link rel="prefetch" href="/blog_publish/assets/js/119.9bed1d4d.js"><link rel="prefetch" href="/blog_publish/assets/js/12.87e18dee.js"><link rel="prefetch" href="/blog_publish/assets/js/120.0be87e62.js"><link rel="prefetch" href="/blog_publish/assets/js/121.de36973e.js"><link rel="prefetch" href="/blog_publish/assets/js/122.cd700b2a.js"><link rel="prefetch" href="/blog_publish/assets/js/123.67469a7f.js"><link rel="prefetch" href="/blog_publish/assets/js/124.e711d895.js"><link rel="prefetch" href="/blog_publish/assets/js/125.78a3f83c.js"><link rel="prefetch" href="/blog_publish/assets/js/126.f475a8d2.js"><link rel="prefetch" href="/blog_publish/assets/js/127.3caeb1b6.js"><link rel="prefetch" href="/blog_publish/assets/js/128.a2b8136a.js"><link rel="prefetch" href="/blog_publish/assets/js/129.7ad62325.js"><link rel="prefetch" href="/blog_publish/assets/js/13.6e9eeb32.js"><link rel="prefetch" href="/blog_publish/assets/js/130.7c87f5c8.js"><link rel="prefetch" href="/blog_publish/assets/js/131.d7af7305.js"><link rel="prefetch" href="/blog_publish/assets/js/132.18c704f8.js"><link rel="prefetch" href="/blog_publish/assets/js/133.71cc66ff.js"><link rel="prefetch" href="/blog_publish/assets/js/134.6f77616d.js"><link rel="prefetch" href="/blog_publish/assets/js/135.57296610.js"><link rel="prefetch" href="/blog_publish/assets/js/136.f0876157.js"><link rel="prefetch" href="/blog_publish/assets/js/137.51357170.js"><link rel="prefetch" href="/blog_publish/assets/js/138.f0096677.js"><link rel="prefetch" href="/blog_publish/assets/js/139.6e7c3886.js"><link rel="prefetch" href="/blog_publish/assets/js/14.89e7daa6.js"><link rel="prefetch" href="/blog_publish/assets/js/140.672c428c.js"><link rel="prefetch" href="/blog_publish/assets/js/141.04e4243c.js"><link rel="prefetch" href="/blog_publish/assets/js/142.90d8a1d4.js"><link rel="prefetch" href="/blog_publish/assets/js/143.da06c6cf.js"><link rel="prefetch" href="/blog_publish/assets/js/144.0d17f1fc.js"><link rel="prefetch" href="/blog_publish/assets/js/145.811c4643.js"><link rel="prefetch" href="/blog_publish/assets/js/146.4c4afe3c.js"><link rel="prefetch" href="/blog_publish/assets/js/147.4a3f4d5c.js"><link rel="prefetch" href="/blog_publish/assets/js/148.fdb3d88c.js"><link rel="prefetch" href="/blog_publish/assets/js/149.6c27e0f8.js"><link rel="prefetch" href="/blog_publish/assets/js/15.c25b3990.js"><link rel="prefetch" href="/blog_publish/assets/js/150.a4ecac4f.js"><link rel="prefetch" href="/blog_publish/assets/js/151.86e6da27.js"><link rel="prefetch" href="/blog_publish/assets/js/152.376d57c9.js"><link rel="prefetch" href="/blog_publish/assets/js/153.96ad63e0.js"><link rel="prefetch" href="/blog_publish/assets/js/154.607d8791.js"><link rel="prefetch" href="/blog_publish/assets/js/155.ba8d33ea.js"><link rel="prefetch" href="/blog_publish/assets/js/156.b34233ac.js"><link rel="prefetch" href="/blog_publish/assets/js/157.6f7d6d8e.js"><link rel="prefetch" href="/blog_publish/assets/js/158.8154f1e9.js"><link rel="prefetch" href="/blog_publish/assets/js/159.0f55b599.js"><link rel="prefetch" href="/blog_publish/assets/js/16.086b5d22.js"><link rel="prefetch" href="/blog_publish/assets/js/160.173434d2.js"><link rel="prefetch" href="/blog_publish/assets/js/161.cbd4d6e2.js"><link rel="prefetch" href="/blog_publish/assets/js/162.8a136a8e.js"><link rel="prefetch" href="/blog_publish/assets/js/163.e8ea3e17.js"><link rel="prefetch" href="/blog_publish/assets/js/164.563927d8.js"><link rel="prefetch" href="/blog_publish/assets/js/165.e5ea31c0.js"><link rel="prefetch" href="/blog_publish/assets/js/166.35ea503d.js"><link rel="prefetch" href="/blog_publish/assets/js/167.3845b77f.js"><link rel="prefetch" href="/blog_publish/assets/js/168.3945f23b.js"><link rel="prefetch" href="/blog_publish/assets/js/169.ffee9098.js"><link rel="prefetch" href="/blog_publish/assets/js/17.36f67267.js"><link rel="prefetch" href="/blog_publish/assets/js/170.f937855f.js"><link rel="prefetch" href="/blog_publish/assets/js/171.7897c7d6.js"><link rel="prefetch" href="/blog_publish/assets/js/172.f0126100.js"><link rel="prefetch" href="/blog_publish/assets/js/173.bf31b110.js"><link rel="prefetch" href="/blog_publish/assets/js/174.c4590b6e.js"><link rel="prefetch" href="/blog_publish/assets/js/175.820c9a97.js"><link rel="prefetch" href="/blog_publish/assets/js/176.7e556b92.js"><link rel="prefetch" href="/blog_publish/assets/js/177.86b6dd62.js"><link rel="prefetch" href="/blog_publish/assets/js/178.d60323ee.js"><link rel="prefetch" href="/blog_publish/assets/js/179.d3c55d73.js"><link rel="prefetch" href="/blog_publish/assets/js/18.49e5f950.js"><link rel="prefetch" href="/blog_publish/assets/js/180.7e1d7daa.js"><link rel="prefetch" href="/blog_publish/assets/js/181.935f05a9.js"><link rel="prefetch" href="/blog_publish/assets/js/182.9f083d26.js"><link rel="prefetch" href="/blog_publish/assets/js/183.5db7d650.js"><link rel="prefetch" href="/blog_publish/assets/js/184.bf901285.js"><link rel="prefetch" href="/blog_publish/assets/js/185.43c451eb.js"><link rel="prefetch" href="/blog_publish/assets/js/186.44f670ac.js"><link rel="prefetch" href="/blog_publish/assets/js/187.d85bcdb5.js"><link rel="prefetch" href="/blog_publish/assets/js/188.ea46513b.js"><link rel="prefetch" href="/blog_publish/assets/js/189.1835e674.js"><link rel="prefetch" href="/blog_publish/assets/js/19.ee4a8330.js"><link rel="prefetch" href="/blog_publish/assets/js/190.f6c6e508.js"><link rel="prefetch" href="/blog_publish/assets/js/191.7e5b1d34.js"><link rel="prefetch" href="/blog_publish/assets/js/192.5c4cf6ed.js"><link rel="prefetch" href="/blog_publish/assets/js/193.06a1646e.js"><link rel="prefetch" href="/blog_publish/assets/js/194.5d56352e.js"><link rel="prefetch" href="/blog_publish/assets/js/195.405c6eaa.js"><link rel="prefetch" href="/blog_publish/assets/js/196.6f46a7e6.js"><link rel="prefetch" href="/blog_publish/assets/js/197.5ddce07d.js"><link rel="prefetch" href="/blog_publish/assets/js/198.88caf0b1.js"><link rel="prefetch" href="/blog_publish/assets/js/199.06db7d09.js"><link rel="prefetch" href="/blog_publish/assets/js/20.a0b386a1.js"><link rel="prefetch" href="/blog_publish/assets/js/200.ccc1debd.js"><link rel="prefetch" href="/blog_publish/assets/js/201.49b737e7.js"><link rel="prefetch" href="/blog_publish/assets/js/202.72087a8c.js"><link rel="prefetch" href="/blog_publish/assets/js/203.9fef4e8c.js"><link rel="prefetch" href="/blog_publish/assets/js/204.3dbd50db.js"><link rel="prefetch" href="/blog_publish/assets/js/205.0451c387.js"><link rel="prefetch" href="/blog_publish/assets/js/206.074eee86.js"><link rel="prefetch" href="/blog_publish/assets/js/207.60e15733.js"><link rel="prefetch" href="/blog_publish/assets/js/208.9508eced.js"><link rel="prefetch" href="/blog_publish/assets/js/209.5d7cc805.js"><link rel="prefetch" href="/blog_publish/assets/js/21.73ccc709.js"><link rel="prefetch" href="/blog_publish/assets/js/210.8af5f6cc.js"><link rel="prefetch" href="/blog_publish/assets/js/211.238c477c.js"><link rel="prefetch" href="/blog_publish/assets/js/212.c984dd08.js"><link rel="prefetch" href="/blog_publish/assets/js/213.bc9c4bce.js"><link rel="prefetch" href="/blog_publish/assets/js/214.e7f7630b.js"><link rel="prefetch" href="/blog_publish/assets/js/215.a49b9947.js"><link rel="prefetch" href="/blog_publish/assets/js/216.7f07727b.js"><link rel="prefetch" href="/blog_publish/assets/js/217.d29a61b4.js"><link rel="prefetch" href="/blog_publish/assets/js/218.45053905.js"><link rel="prefetch" href="/blog_publish/assets/js/219.6f6f9cc4.js"><link rel="prefetch" href="/blog_publish/assets/js/22.096b7b82.js"><link rel="prefetch" href="/blog_publish/assets/js/220.a00ab2eb.js"><link rel="prefetch" href="/blog_publish/assets/js/221.192d71f9.js"><link rel="prefetch" href="/blog_publish/assets/js/222.61b9e08a.js"><link rel="prefetch" href="/blog_publish/assets/js/223.9b006ef0.js"><link rel="prefetch" href="/blog_publish/assets/js/224.b3b87f2a.js"><link rel="prefetch" href="/blog_publish/assets/js/225.6ae047dc.js"><link rel="prefetch" href="/blog_publish/assets/js/226.96cfced5.js"><link rel="prefetch" href="/blog_publish/assets/js/227.13ce61e8.js"><link rel="prefetch" href="/blog_publish/assets/js/228.7b9e42dd.js"><link rel="prefetch" href="/blog_publish/assets/js/229.27777a10.js"><link rel="prefetch" href="/blog_publish/assets/js/23.d7551074.js"><link rel="prefetch" href="/blog_publish/assets/js/230.85af1d8e.js"><link rel="prefetch" href="/blog_publish/assets/js/231.04d69469.js"><link rel="prefetch" href="/blog_publish/assets/js/232.209ad968.js"><link rel="prefetch" href="/blog_publish/assets/js/233.e54a4de2.js"><link rel="prefetch" href="/blog_publish/assets/js/234.1fd95981.js"><link rel="prefetch" href="/blog_publish/assets/js/235.241ef2c3.js"><link rel="prefetch" href="/blog_publish/assets/js/236.00d7878e.js"><link rel="prefetch" href="/blog_publish/assets/js/237.8e9aa106.js"><link rel="prefetch" href="/blog_publish/assets/js/238.0e5ff9e6.js"><link rel="prefetch" href="/blog_publish/assets/js/239.b756da28.js"><link rel="prefetch" href="/blog_publish/assets/js/24.62361c56.js"><link rel="prefetch" href="/blog_publish/assets/js/240.54b25b7c.js"><link rel="prefetch" href="/blog_publish/assets/js/241.992440ea.js"><link rel="prefetch" href="/blog_publish/assets/js/242.c0667b9a.js"><link rel="prefetch" href="/blog_publish/assets/js/243.99336fa0.js"><link rel="prefetch" href="/blog_publish/assets/js/244.9180ac12.js"><link rel="prefetch" href="/blog_publish/assets/js/245.db62d2b1.js"><link rel="prefetch" href="/blog_publish/assets/js/246.2b42d331.js"><link rel="prefetch" href="/blog_publish/assets/js/247.8410b969.js"><link rel="prefetch" href="/blog_publish/assets/js/248.8879df79.js"><link rel="prefetch" href="/blog_publish/assets/js/249.f69c9393.js"><link rel="prefetch" href="/blog_publish/assets/js/25.032e870d.js"><link rel="prefetch" href="/blog_publish/assets/js/250.c4142bf4.js"><link rel="prefetch" href="/blog_publish/assets/js/251.3732f71e.js"><link rel="prefetch" href="/blog_publish/assets/js/252.161211c2.js"><link rel="prefetch" href="/blog_publish/assets/js/253.e5f62e16.js"><link rel="prefetch" href="/blog_publish/assets/js/254.18a06355.js"><link rel="prefetch" href="/blog_publish/assets/js/255.f06c4405.js"><link rel="prefetch" href="/blog_publish/assets/js/256.9a594807.js"><link rel="prefetch" href="/blog_publish/assets/js/257.b3c33fa1.js"><link rel="prefetch" href="/blog_publish/assets/js/258.9d8f46d5.js"><link rel="prefetch" href="/blog_publish/assets/js/259.69aaea00.js"><link rel="prefetch" href="/blog_publish/assets/js/26.56288e39.js"><link rel="prefetch" href="/blog_publish/assets/js/260.ec29d518.js"><link rel="prefetch" href="/blog_publish/assets/js/261.5dddbd98.js"><link rel="prefetch" href="/blog_publish/assets/js/262.ddb0d58b.js"><link rel="prefetch" href="/blog_publish/assets/js/263.84db8d94.js"><link rel="prefetch" href="/blog_publish/assets/js/264.65308470.js"><link rel="prefetch" href="/blog_publish/assets/js/265.9f83f374.js"><link rel="prefetch" href="/blog_publish/assets/js/266.810ebbbd.js"><link rel="prefetch" href="/blog_publish/assets/js/267.bbcd99a0.js"><link rel="prefetch" href="/blog_publish/assets/js/268.e0175617.js"><link rel="prefetch" href="/blog_publish/assets/js/269.db86caf6.js"><link rel="prefetch" href="/blog_publish/assets/js/27.3dc7255d.js"><link rel="prefetch" href="/blog_publish/assets/js/270.8293c6a0.js"><link rel="prefetch" href="/blog_publish/assets/js/271.aef599d4.js"><link rel="prefetch" href="/blog_publish/assets/js/272.77e24a14.js"><link rel="prefetch" href="/blog_publish/assets/js/273.8736cb7f.js"><link rel="prefetch" href="/blog_publish/assets/js/274.bd0637a2.js"><link rel="prefetch" href="/blog_publish/assets/js/275.824bcaa8.js"><link rel="prefetch" href="/blog_publish/assets/js/276.43e2c222.js"><link rel="prefetch" href="/blog_publish/assets/js/277.e77b08bd.js"><link rel="prefetch" href="/blog_publish/assets/js/278.1dd983f2.js"><link rel="prefetch" href="/blog_publish/assets/js/279.28c76b58.js"><link rel="prefetch" href="/blog_publish/assets/js/28.a7be37ee.js"><link rel="prefetch" href="/blog_publish/assets/js/280.1b939223.js"><link rel="prefetch" href="/blog_publish/assets/js/281.b8307600.js"><link rel="prefetch" href="/blog_publish/assets/js/282.5f701010.js"><link rel="prefetch" href="/blog_publish/assets/js/283.15e72b2d.js"><link rel="prefetch" href="/blog_publish/assets/js/284.e03f9c7e.js"><link rel="prefetch" href="/blog_publish/assets/js/285.7fd01dca.js"><link rel="prefetch" href="/blog_publish/assets/js/286.d12777bb.js"><link rel="prefetch" href="/blog_publish/assets/js/287.20653481.js"><link rel="prefetch" href="/blog_publish/assets/js/288.d5a38995.js"><link rel="prefetch" href="/blog_publish/assets/js/289.2f12ce91.js"><link rel="prefetch" href="/blog_publish/assets/js/29.445e66ff.js"><link rel="prefetch" href="/blog_publish/assets/js/290.0b57f0df.js"><link rel="prefetch" href="/blog_publish/assets/js/291.e3f9e8bb.js"><link rel="prefetch" href="/blog_publish/assets/js/292.2abf83e0.js"><link rel="prefetch" href="/blog_publish/assets/js/293.20f3c9b8.js"><link rel="prefetch" href="/blog_publish/assets/js/294.db2d3349.js"><link rel="prefetch" href="/blog_publish/assets/js/295.16d89409.js"><link rel="prefetch" href="/blog_publish/assets/js/296.6b51ef28.js"><link rel="prefetch" href="/blog_publish/assets/js/297.95d9cd42.js"><link rel="prefetch" href="/blog_publish/assets/js/298.e64c45d3.js"><link rel="prefetch" href="/blog_publish/assets/js/299.1e8e4795.js"><link rel="prefetch" href="/blog_publish/assets/js/3.7b5be556.js"><link rel="prefetch" href="/blog_publish/assets/js/30.a7b56cf2.js"><link rel="prefetch" href="/blog_publish/assets/js/300.b76c16da.js"><link rel="prefetch" href="/blog_publish/assets/js/301.0c53f631.js"><link rel="prefetch" href="/blog_publish/assets/js/302.716e06ad.js"><link rel="prefetch" href="/blog_publish/assets/js/303.dd57635e.js"><link rel="prefetch" href="/blog_publish/assets/js/304.444aa624.js"><link rel="prefetch" href="/blog_publish/assets/js/305.869777c3.js"><link rel="prefetch" href="/blog_publish/assets/js/306.add1a9e4.js"><link rel="prefetch" href="/blog_publish/assets/js/307.ee7be797.js"><link rel="prefetch" href="/blog_publish/assets/js/308.2ec8c332.js"><link rel="prefetch" href="/blog_publish/assets/js/309.52da4e86.js"><link rel="prefetch" href="/blog_publish/assets/js/31.adfce4e3.js"><link rel="prefetch" href="/blog_publish/assets/js/310.2ccafb29.js"><link rel="prefetch" href="/blog_publish/assets/js/311.ad7282bd.js"><link rel="prefetch" href="/blog_publish/assets/js/312.ea8314af.js"><link rel="prefetch" href="/blog_publish/assets/js/313.8109d101.js"><link rel="prefetch" href="/blog_publish/assets/js/314.8d7f5bff.js"><link rel="prefetch" href="/blog_publish/assets/js/315.49b7621d.js"><link rel="prefetch" href="/blog_publish/assets/js/316.198b1162.js"><link rel="prefetch" href="/blog_publish/assets/js/317.c6ec84b2.js"><link rel="prefetch" href="/blog_publish/assets/js/318.ac920d7d.js"><link rel="prefetch" href="/blog_publish/assets/js/319.71a5ffde.js"><link rel="prefetch" href="/blog_publish/assets/js/32.55741b61.js"><link rel="prefetch" href="/blog_publish/assets/js/320.2d0f4e96.js"><link rel="prefetch" href="/blog_publish/assets/js/321.b451ac55.js"><link rel="prefetch" href="/blog_publish/assets/js/322.44402895.js"><link rel="prefetch" href="/blog_publish/assets/js/323.544b08d7.js"><link rel="prefetch" href="/blog_publish/assets/js/324.61bfd4fa.js"><link rel="prefetch" href="/blog_publish/assets/js/325.9a00eb5d.js"><link rel="prefetch" href="/blog_publish/assets/js/326.757f14d4.js"><link rel="prefetch" href="/blog_publish/assets/js/327.904195aa.js"><link rel="prefetch" href="/blog_publish/assets/js/328.0fc260ae.js"><link rel="prefetch" href="/blog_publish/assets/js/329.1d232900.js"><link rel="prefetch" href="/blog_publish/assets/js/330.d6df5b21.js"><link rel="prefetch" href="/blog_publish/assets/js/331.a384ada5.js"><link rel="prefetch" href="/blog_publish/assets/js/332.1c65f28a.js"><link rel="prefetch" href="/blog_publish/assets/js/333.e5ecf7a2.js"><link rel="prefetch" href="/blog_publish/assets/js/334.1ce2d374.js"><link rel="prefetch" href="/blog_publish/assets/js/335.e02cdb04.js"><link rel="prefetch" href="/blog_publish/assets/js/336.fc6022e1.js"><link rel="prefetch" href="/blog_publish/assets/js/337.2b2238df.js"><link rel="prefetch" href="/blog_publish/assets/js/338.e9a5ec83.js"><link rel="prefetch" href="/blog_publish/assets/js/339.78906c2a.js"><link rel="prefetch" href="/blog_publish/assets/js/34.67310adf.js"><link rel="prefetch" href="/blog_publish/assets/js/340.594178f5.js"><link rel="prefetch" href="/blog_publish/assets/js/341.5dd81929.js"><link rel="prefetch" href="/blog_publish/assets/js/342.78d3a0cd.js"><link rel="prefetch" href="/blog_publish/assets/js/343.ed7cccf1.js"><link rel="prefetch" href="/blog_publish/assets/js/344.9ddc9d34.js"><link rel="prefetch" href="/blog_publish/assets/js/345.1bad36e6.js"><link rel="prefetch" href="/blog_publish/assets/js/346.9fec11c3.js"><link rel="prefetch" href="/blog_publish/assets/js/347.a0fbc2f1.js"><link rel="prefetch" href="/blog_publish/assets/js/348.5b44a51c.js"><link rel="prefetch" href="/blog_publish/assets/js/349.09204542.js"><link rel="prefetch" href="/blog_publish/assets/js/35.aa5fe427.js"><link rel="prefetch" href="/blog_publish/assets/js/350.91a973ac.js"><link rel="prefetch" href="/blog_publish/assets/js/351.2a79e48d.js"><link rel="prefetch" href="/blog_publish/assets/js/352.2523e91f.js"><link rel="prefetch" href="/blog_publish/assets/js/353.3997b1a0.js"><link rel="prefetch" href="/blog_publish/assets/js/354.59342270.js"><link rel="prefetch" href="/blog_publish/assets/js/355.f5372a93.js"><link rel="prefetch" href="/blog_publish/assets/js/356.6e67765b.js"><link rel="prefetch" href="/blog_publish/assets/js/357.a16abdfb.js"><link rel="prefetch" href="/blog_publish/assets/js/358.402c4f28.js"><link rel="prefetch" href="/blog_publish/assets/js/359.f348ea62.js"><link rel="prefetch" href="/blog_publish/assets/js/36.1ae1780d.js"><link rel="prefetch" href="/blog_publish/assets/js/360.0fb57131.js"><link rel="prefetch" href="/blog_publish/assets/js/361.2ada4743.js"><link rel="prefetch" href="/blog_publish/assets/js/362.68c2224c.js"><link rel="prefetch" href="/blog_publish/assets/js/363.14feca85.js"><link rel="prefetch" href="/blog_publish/assets/js/364.6272e86d.js"><link rel="prefetch" href="/blog_publish/assets/js/365.7a4d0c79.js"><link rel="prefetch" href="/blog_publish/assets/js/366.11b6f603.js"><link rel="prefetch" href="/blog_publish/assets/js/367.d26dac09.js"><link rel="prefetch" href="/blog_publish/assets/js/368.0b0edfcc.js"><link rel="prefetch" href="/blog_publish/assets/js/369.faca4222.js"><link rel="prefetch" href="/blog_publish/assets/js/37.ee13059e.js"><link rel="prefetch" href="/blog_publish/assets/js/370.e66d92fc.js"><link rel="prefetch" href="/blog_publish/assets/js/371.d8599009.js"><link rel="prefetch" href="/blog_publish/assets/js/372.ad1c21a9.js"><link rel="prefetch" href="/blog_publish/assets/js/373.ac79a3fa.js"><link rel="prefetch" href="/blog_publish/assets/js/38.9eb621f0.js"><link rel="prefetch" href="/blog_publish/assets/js/39.b9201e3a.js"><link rel="prefetch" href="/blog_publish/assets/js/4.b0cb765d.js"><link rel="prefetch" href="/blog_publish/assets/js/40.3c3b852e.js"><link rel="prefetch" href="/blog_publish/assets/js/41.4097d760.js"><link rel="prefetch" href="/blog_publish/assets/js/42.9ac60e0e.js"><link rel="prefetch" href="/blog_publish/assets/js/43.37eab88b.js"><link rel="prefetch" href="/blog_publish/assets/js/44.650e2b5b.js"><link rel="prefetch" href="/blog_publish/assets/js/45.56567d27.js"><link rel="prefetch" href="/blog_publish/assets/js/46.3db58dc9.js"><link rel="prefetch" href="/blog_publish/assets/js/47.f6fabe74.js"><link rel="prefetch" href="/blog_publish/assets/js/48.7e246cbd.js"><link rel="prefetch" href="/blog_publish/assets/js/49.6417fcf5.js"><link rel="prefetch" href="/blog_publish/assets/js/5.e723c1a9.js"><link rel="prefetch" href="/blog_publish/assets/js/50.cdfb586e.js"><link rel="prefetch" href="/blog_publish/assets/js/51.8c3db94b.js"><link rel="prefetch" href="/blog_publish/assets/js/52.ab9331d2.js"><link rel="prefetch" href="/blog_publish/assets/js/53.5fa8a3f8.js"><link rel="prefetch" href="/blog_publish/assets/js/54.66faffc7.js"><link rel="prefetch" href="/blog_publish/assets/js/55.2a88dfef.js"><link rel="prefetch" href="/blog_publish/assets/js/56.f14fd535.js"><link rel="prefetch" href="/blog_publish/assets/js/57.8f8e8c73.js"><link rel="prefetch" href="/blog_publish/assets/js/58.7f45728b.js"><link rel="prefetch" href="/blog_publish/assets/js/59.330ac8e0.js"><link rel="prefetch" href="/blog_publish/assets/js/6.43debd78.js"><link rel="prefetch" href="/blog_publish/assets/js/60.1d144226.js"><link rel="prefetch" href="/blog_publish/assets/js/61.eae4e188.js"><link rel="prefetch" href="/blog_publish/assets/js/62.ca7a88bd.js"><link rel="prefetch" href="/blog_publish/assets/js/63.63ad730b.js"><link rel="prefetch" href="/blog_publish/assets/js/64.07a7e3a3.js"><link rel="prefetch" href="/blog_publish/assets/js/65.16d0a780.js"><link rel="prefetch" href="/blog_publish/assets/js/66.c0275e13.js"><link rel="prefetch" href="/blog_publish/assets/js/67.37f9f152.js"><link rel="prefetch" href="/blog_publish/assets/js/68.45707e21.js"><link rel="prefetch" href="/blog_publish/assets/js/69.bfdbe5e9.js"><link rel="prefetch" href="/blog_publish/assets/js/7.23b88edf.js"><link rel="prefetch" href="/blog_publish/assets/js/70.d47a2bce.js"><link rel="prefetch" href="/blog_publish/assets/js/71.e58709b8.js"><link rel="prefetch" href="/blog_publish/assets/js/72.8608e946.js"><link rel="prefetch" href="/blog_publish/assets/js/73.46aa4360.js"><link rel="prefetch" href="/blog_publish/assets/js/74.0fccbeb8.js"><link rel="prefetch" href="/blog_publish/assets/js/75.7353b526.js"><link rel="prefetch" href="/blog_publish/assets/js/76.0770d54e.js"><link rel="prefetch" href="/blog_publish/assets/js/77.48353ebb.js"><link rel="prefetch" href="/blog_publish/assets/js/78.09c3bef7.js"><link rel="prefetch" href="/blog_publish/assets/js/79.99dacc09.js"><link rel="prefetch" href="/blog_publish/assets/js/8.e43be2dc.js"><link rel="prefetch" href="/blog_publish/assets/js/80.d7dbccbf.js"><link rel="prefetch" href="/blog_publish/assets/js/81.598d9f04.js"><link rel="prefetch" href="/blog_publish/assets/js/82.f8540f3f.js"><link rel="prefetch" href="/blog_publish/assets/js/83.af673b81.js"><link rel="prefetch" href="/blog_publish/assets/js/84.8a6fa1bd.js"><link rel="prefetch" href="/blog_publish/assets/js/85.7dce41b0.js"><link rel="prefetch" href="/blog_publish/assets/js/86.7bf2ad81.js"><link rel="prefetch" href="/blog_publish/assets/js/87.02c54772.js"><link rel="prefetch" href="/blog_publish/assets/js/88.cb8a4a5f.js"><link rel="prefetch" href="/blog_publish/assets/js/89.3b6e0231.js"><link rel="prefetch" href="/blog_publish/assets/js/9.7f7afe5d.js"><link rel="prefetch" href="/blog_publish/assets/js/90.1535c9fb.js"><link rel="prefetch" href="/blog_publish/assets/js/91.c60cb8ee.js"><link rel="prefetch" href="/blog_publish/assets/js/92.969d8b39.js"><link rel="prefetch" href="/blog_publish/assets/js/93.ebbadaf8.js"><link rel="prefetch" href="/blog_publish/assets/js/94.88d36bba.js"><link rel="prefetch" href="/blog_publish/assets/js/95.80133b18.js"><link rel="prefetch" href="/blog_publish/assets/js/96.4f81889a.js"><link rel="prefetch" href="/blog_publish/assets/js/97.9a25e809.js"><link rel="prefetch" href="/blog_publish/assets/js/98.a7ec2fdf.js"><link rel="prefetch" href="/blog_publish/assets/js/99.5d254e48.js">
    <link rel="stylesheet" href="/blog_publish/assets/css/0.styles.9a82886c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog_publish/" class="home-link router-link-active"><!----> <span class="site-name">coder</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog_publish/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog_publish/java/01_ProgrammingBasic/link.html" class="nav-link">
  编程基础
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/java/02_DevelopmentTools/link.html" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/java/03_ApplicationFramework/link.html" class="nav-link">
  应用框架
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/java/04_OperationAndMaintenance/" class="nav-link">
  运维
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/java/05_SourceCode/" class="nav-link">
  源码
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog_publish/web/01_vue/使用webpack打包一个简单的前端程序.html" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog_publish/tools/essay/04_SpringBoot中处理跨域的几种方式.html" class="nav-link">
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/tools/installSoftware/01_jdk_linux.html" class="nav-link">
  软件安装
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/tools/bugRepository/03_MySQL主从复制Bug.html" class="nav-link">
  bug库
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/tools/other/07_打包插件maven-assembly-plugin.html" class="nav-link">
  其他
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog_publish/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog_publish/java/01_ProgrammingBasic/link.html" class="nav-link">
  编程基础
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/java/02_DevelopmentTools/link.html" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/java/03_ApplicationFramework/link.html" class="nav-link">
  应用框架
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/java/04_OperationAndMaintenance/" class="nav-link">
  运维
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/java/05_SourceCode/" class="nav-link">
  源码
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog_publish/web/01_vue/使用webpack打包一个简单的前端程序.html" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog_publish/tools/essay/04_SpringBoot中处理跨域的几种方式.html" class="nav-link">
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/tools/installSoftware/01_jdk_linux.html" class="nav-link">
  软件安装
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/tools/bugRepository/03_MySQL主从复制Bug.html" class="nav-link">
  bug库
</a></li><li class="dropdown-item"><!----> <a href="/blog_publish/tools/other/07_打包插件maven-assembly-plugin.html" class="nav-link">
  其他
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/01_jvm.html" class="sidebar-link">JVM</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/01_JVM与Java体系结构.html" class="sidebar-link">JVM与Java体系结构</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/02_类加载子系统.html" class="sidebar-link">类加载子系统</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/03_运行时数据区概述及线程.html" class="sidebar-link">运行时数据区概述及线程</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/04_程序计数器.html" class="sidebar-link">程序计数器</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html" class="active sidebar-link">虚拟机栈</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#一、虚拟机栈概述" class="sidebar-link">一、虚拟机栈概述</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#二、栈的存储单位" class="sidebar-link">二、栈的存储单位</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#三、局部变量表" class="sidebar-link">三、局部变量表</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#四、操作数栈" class="sidebar-link">四、操作数栈</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#五、代码追踪" class="sidebar-link">五、代码追踪</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#六、栈顶缓存技术（top-of-stack-caching）" class="sidebar-link">六、栈顶缓存技术（Top Of Stack Caching）</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#七、动态链接-dynamic-linking" class="sidebar-link">七、动态链接(Dynamic Linking)</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#八、方法的调用：解析与分派" class="sidebar-link">八、方法的调用：解析与分派</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#九、方法返回地址" class="sidebar-link">九、方法返回地址</a></li><li class="sidebar-sub-header"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/05_虚拟机栈.html#十、关于栈的面试题" class="sidebar-link">十、关于栈的面试题</a></li></ul></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/06_本地方法接口.html" class="sidebar-link">本地方法接口</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/07_本地方法栈.html" class="sidebar-link">本地方法栈</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/08_堆.html" class="sidebar-link">堆</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/09_方法区.html" class="sidebar-link">方法区</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/10_对象的实例化内存布局与访问定位.html" class="sidebar-link">对象的实例化内存布局与访问定位</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/11_直接内存.html" class="sidebar-link">直接内存</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/12_执行引擎.html" class="sidebar-link">执行引擎</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/13_StringTable.html" class="sidebar-link">StringTable</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/14_垃圾回收概述.html" class="sidebar-link">垃圾回收概述</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/15_垃圾回收相关算法.html" class="sidebar-link">垃圾回收相关算法</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/16_垃圾回收相关概念.html" class="sidebar-link">垃圾回收相关概念</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/17_垃圾回收器.html" class="sidebar-link">垃圾回收器</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/18_Class文件结构.html" class="sidebar-link">Class文件结构</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/19_字节码指令集与解析举例.html" class="sidebar-link">字节码指令集与解析举例</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/20_类的加载过程.html" class="sidebar-link">类的加载过程</a></li><li><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/21_类的加载器.html" class="sidebar-link">类的加载器</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>多线程&amp;高并发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JDK_Tools</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="虚拟机栈"><a href="#虚拟机栈" class="header-anchor">#</a> 虚拟机栈</h1> <h2 id="一、虚拟机栈概述"><a href="#一、虚拟机栈概述" class="header-anchor">#</a> 一、虚拟机栈概述</h2> <h3 id="_1-1-虚拟机栈出现的背景"><a href="#_1-1-虚拟机栈出现的背景" class="header-anchor">#</a> 1.1 虚拟机栈出现的背景</h3> <ul><li>由于跨平台性的设计，Java的指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的。</li> <li><strong>优点是跨平台，指令集小，编译器容易实现，缺点是性能下降，实现同样的功能需要更多的指令。</strong></li></ul> <h3 id="_1-2-内存中的栈与堆"><a href="#_1-2-内存中的栈与堆" class="header-anchor">#</a> 1.2 内存中的栈与堆</h3> <ul><li><strong>栈是运行时的单位，而堆是存储的单位</strong></li> <li><strong>栈解决程序的运行问题</strong>，即<strong>程序如何执行，或者说如何处理数据</strong>。</li> <li><strong>堆解决的是数据存储的问题</strong>，即<strong>数据怎么放，放哪里</strong></li></ul> <p><a data-fancybox="" title="23c85d3154519764ceb36f7f743213b0" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/4020868d929141758fe86f6f6b3ca99f.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/4020868d929141758fe86f6f6b3ca99f.png" alt="23c85d3154519764ceb36f7f743213b0"></a></p> <h3 id="_1-3-虚拟机栈的基本内容"><a href="#_1-3-虚拟机栈的基本内容" class="header-anchor">#</a> 1.3 虚拟机栈的基本内容</h3> <p>Java虚拟机栈（Java Virtual Machine Stack），早期也叫Java栈。<strong>每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个的栈帧（Stack Frame），对应着一次次的Java方法调用</strong></p> <ul><li>栈是线程私有的</li> <li>一个方法对应一个栈帧的入栈和出栈</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StackTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StackTest</span> stackTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StackTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stackTest<span class="token punctuation">.</span><span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>虚拟机栈的生命周期：<strong>生命周期和线程一致，也就是线程结束了，该虚拟机栈也销毁了</strong></p> <p>主管Java程序的运行，它保存方法的局部变量（8 种基本数据类型、对象的引用地址）、部分结果，并参与方法的调用和返回。</p> <ul><li>局部变量 VS 成员变量（属性）</li> <li>基本数据类型变量 VS 引用类型变量（类、数组、接口）</li></ul> <h3 id="_1-4-虚拟机栈的特点"><a href="#_1-4-虚拟机栈的特点" class="header-anchor">#</a> 1.4 虚拟机栈的特点</h3> <p>栈是一种快速有效的分配存储方式，访问速度仅次于程序计数器。</p> <ul><li>JVM直接对Java栈的操作只有两个：
<ul><li>每个方法执行，伴随着进栈（入栈、压栈）</li> <li>执行结束后的出栈工作</li></ul></li> <li>对于栈来说不存在垃圾回收 (GC) 问题（栈存在溢出的情况）</li></ul> <h3 id="_1-5-虚拟机栈的异常"><a href="#_1-5-虚拟机栈的异常" class="header-anchor">#</a> 1.5 虚拟机栈的异常</h3> <blockquote><p>栈中可能出现的异常</p></blockquote> <ul><li>Java 虚拟机规范允许Java栈的大小是动态的或者是固定不变的。</li> <li>如果采用固定大小的Java虚拟机栈，那每一个线程的Java虚拟机栈容量可以在线程创建的时候确定。</li> <li>如果线程请求分配的栈容量超过Java虚拟机栈允许的最大容量，Java虚拟机将会抛出一个StackoverflowError 异常。简称：栈溢出</li> <li>如果Java虚拟机栈可以动态扩展，并且在尝试扩展的时候无法申请到足够的内存，或者在创建新的线程时没有足够的内存去创建对应的虚拟机栈，那Java虚拟机将会抛出一个 OutOfMemoryError 异常。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StackTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a data-fancybox="" title="image-20210302152017643" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/80f5ac0208ee4b988070ae00f63d9bb4.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/80f5ac0208ee4b988070ae00f63d9bb4.png" alt="image-20210302152017643"></a></p> <h3 id="_1-6-设置栈的大小"><a href="#_1-6-设置栈的大小" class="header-anchor">#</a> 1.6 设置栈的大小</h3> <p>使用参数 <code>-Xss</code>选项来设置线程的最大栈空间，栈的大小直接决定了函数调用的最大可达深度。</p> <div class="language- extra-class"><pre class="language-text"><code>-Xss1024m		// 栈内存为 1024MBS
-Xss1024k		// 栈内存为 1024KB
</code></pre></div><h2 id="二、栈的存储单位"><a href="#二、栈的存储单位" class="header-anchor">#</a> 二、栈的存储单位</h2> <h3 id="_2-1-栈中存储的内容"><a href="#_2-1-栈中存储的内容" class="header-anchor">#</a> 2.1 栈中存储的内容</h3> <ul><li>每个线程都有自己的栈，栈中的数据都是以栈帧（Stack Frame）为基本单位存储的</li> <li>在这个线程上正在执行的每个方法都各自对应一个栈帧（Stack Frame）。</li> <li>一个方法的执行对应一个栈帧的入栈，一个方法的执行结束对应一个栈帧的出栈</li> <li><strong>栈帧是一个内存区块，是一个数据集，存储方法执行过程中的各种数据信息。</strong></li></ul> <h3 id="_2-2-栈的运行原理"><a href="#_2-2-栈的运行原理" class="header-anchor">#</a> 2.2 栈的运行原理</h3> <ul><li>JVM直接对Java栈的操作只有两个，<strong>入栈与出栈</strong>，<strong>栈遵循先进后出（后进先出）原则</strong></li> <li>在一条活动线程中，一个时间点上，只会有一个活动的栈帧。即只有当前正在执行的方法的栈帧（栈顶栈帧）是有效的，这个栈帧被称为<strong>当前栈帧（Current Frame）</strong></li> <li>与当前栈帧相对应的方法就是<strong>当前方法（Current Method）</strong></li> <li>定义这个方法的类就是<strong>当前类（Current Class）</strong></li> <li>执行引擎运行的所有字节码指令只针对当前栈帧进行操作。</li> <li>如果在该方法中调用了其他方法，对应的新的栈帧会被创建出来，放在栈的顶端，<strong>成为新的当前帧</strong>。</li> <li><strong>不同线程中所包含的栈帧是不允许存在相互引用的，即不可能在一个栈帧之中引用另外一个线程的栈帧。</strong></li> <li>如果当前方法调用了其他方法，方法返回之际，当前栈帧会传回此方法的执行结果给前一个栈帧，接着，虚拟机会丢弃当前栈帧，使得前一个栈帧重新成为当前栈帧。</li> <li>Java方法有两种返回函数的方式，但不管使用哪种方式，都会导致栈帧被弹出
<ul><li><strong>一种是正常的函数返回，使用 return 指令</strong></li> <li><strong>另外一种是抛出异常</strong></li></ul></li></ul> <h3 id="_2-3-栈帧的内部结构"><a href="#_2-3-栈帧的内部结构" class="header-anchor">#</a> 2.3 栈帧的内部结构</h3> <p>每个栈帧存储的数据有：</p> <ul><li><strong>局部变量表（Local Variables）</strong></li> <li><strong>操作数栈（Operand Stack）（或表达式栈）</strong></li> <li>动态链接（Dynamic Linking）（或指向运行时常量池的方法引用）</li> <li>方法返回地址（Return Address）（或方法正常退出或者异常退出的定义）</li> <li>一些附加信息</li></ul> <p>每个线程下的栈都是私有的，因此每个线程都有自己各自的栈，并且每个栈里面都有很多栈帧，栈帧的大小主要由 <strong>局部变量表</strong> 和 <strong>操作数栈</strong> 决定的</p> <p><a data-fancybox="" title="0030ce3cbaa7c7a628416766ae77a8cd" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/a1d4cd0ac4ee483f8282443bd93f9c70.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/a1d4cd0ac4ee483f8282443bd93f9c70.png" alt="0030ce3cbaa7c7a628416766ae77a8cd"></a></p> <h2 id="三、局部变量表"><a href="#三、局部变量表" class="header-anchor">#</a> 三、局部变量表</h2> <h3 id="_3-1-局部变量表介绍"><a href="#_3-1-局部变量表介绍" class="header-anchor">#</a> 3.1 局部变量表介绍</h3> <ul><li>局部变量表：Local Variables，也被称之为局部变量数组或本地变量表</li> <li>定义为一个数字数组，主要用于存储方法参数和定义在方法体内的局部变量，这些数据类型包括各类基本数据类型、对象引用（reference），以及 returnAddress(返回值) 类型。</li> <li>由于局部变量表是建立在线程的栈上，是线程的私有数据，因此不存在数据安全问题</li> <li>局部变量表所需的容量大小是在编译期确定下来的，并保存在方法的Code属性的maximum local variables数据项中。在方法运行期间是不会改变局部变量表的大小的。</li> <li>方法嵌套调用的次数由栈的大小决定。一般来说，栈越大，方法嵌套调用次数越多。
<ul><li>对一个函数而言，它的参数和局部变量越多，使得局部变量表膨胀，它的栈帧就越大，以满足方法调用所需传递的信息增大的需求。</li> <li>进而函数调用就会占用更多的栈空间，导致其嵌套调用次数就会减少。</li></ul></li> <li>局部变量表中的变量只在当前方法调用中有效。
<ul><li>在方法执行时，虚拟机通过使用局部变量表完成参数值到参数变量列表的传递过程。</li> <li>当方法调用结束后，随着方法栈帧的销毁，局部变量表也会随之销毁。</li></ul></li></ul> <p>举例说明：<strong>局部变量表所需的容量大小是在编译期确定下来的</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalVariableTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LocalVariableTest</span> localVariableTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalVariableTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        localVariableTest<span class="token punctuation">.</span><span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;xiaoxiao&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token function">test2</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token class-name">Date</span> date2<span class="token punctuation">,</span> <span class="token class-name">String</span> name2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        date2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        name2 <span class="token operator">=</span> <span class="token string">&quot;xiaoxiao2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> weight <span class="token operator">=</span> <span class="token number">222.2</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> sex <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> date2 <span class="token operator">+</span> name2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a data-fancybox="" title="image-20210302160633253" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/8381570481194f618aec6602cf8a607f.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/8381570481194f618aec6602cf8a607f.png" alt="image-20210302160633253"></a></p> <p><a data-fancybox="" title="image-20210302160713396" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/389878d26bdf4a1f8b0750367b611c55.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/389878d26bdf4a1f8b0750367b611c55.png" alt="image-20210302160713396"></a></p> <p><a data-fancybox="" title="image-20210302160810688" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/ef93ae2a5def42068fa0e008aa24ea3d.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/ef93ae2a5def42068fa0e008aa24ea3d.png" alt="image-20210302160810688"></a></p> <p><a data-fancybox="" title="1dec411f57c684573b6ec0d6e9600453" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/c5c6d8b026624ff3821ede3ce6d0fa9e.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/c5c6d8b026624ff3821ede3ce6d0fa9e.png" alt="1dec411f57c684573b6ec0d6e9600453"></a></p> <p><a data-fancybox="" title="848c702455dbedb08bb5ac70901452c8" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/350b35aa95b5496f877123d2e9da7d1c.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/350b35aa95b5496f877123d2e9da7d1c.png" alt="848c702455dbedb08bb5ac70901452c8"></a></p> <p><a data-fancybox="" title="26cb9eaeeb1d169bc9e2046d22735ab7" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/6be872fb0a3f42d58efa8d1b059b3c78.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/6be872fb0a3f42d58efa8d1b059b3c78.png" alt="26cb9eaeeb1d169bc9e2046d22735ab7"></a></p> <p><a data-fancybox="" title="ee5a938d646f1a298f44b27f4f96ac25" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/182b833d188f472a8164522cb8abffdc.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/182b833d188f472a8164522cb8abffdc.png" alt="ee5a938d646f1a298f44b27f4f96ac25"></a></p> <h3 id="_3-2-关于slot的介绍"><a href="#_3-2-关于slot的介绍" class="header-anchor">#</a> 3.2 关于<code>Slot</code>的介绍</h3> <ul><li><p>参数值的存放总是从局部变量数组索引 0 的位置开始，到数组长度-1的索引结束。</p></li> <li><p>局部变量表，最基本的存储单元是Slot（变量槽）</p></li> <li><p>局部变量表中存放编译期可知的各种基本数据类型（8种），引用类型（reference），returnAddress类型的变量。</p></li> <li><p>在局部变量表里，32位以内的类型只占用一个slot（包括 引用类型、returnAddress类型），64位的类型（long和double）占用两个slot。</p> <ul><li>byte、short、char 在存储前被转换为int，boolean 也被转换为int，0 表示false，非0 表示true</li> <li>long 和 double 则占据两个Slot</li></ul></li> <li><p>JVM会为局部变量表中的每一个Slot都分配一个访问索引，通过这个索引即可成功访问到局部变量表中指定的局部变量值</p></li> <li><p>当一个实例方法被调用的时候，它的方法参数和方法体内部定义的局部变量将会按照顺序被复制到局部变量表中的每一个slot上</p></li> <li><p>如果需要访问局部变量表中一个64bit的局部变量值时，只需要使用前一个索引即可。（比如：访问long或double类型变量）</p></li> <li><p>如果当前帧是由构造方法或者实例方法(非静态方法) 创建的，那么该对象引用this 将会存放在index为0 的slot处，其余的参数按照参数表顺序继续排列。</p></li> <li><p><a data-fancybox="" title="828438bb2270f5d36faaeb1581d65719" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/703f155e59de4eba8372ec447e7d69f7.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/703f155e59de4eba8372ec447e7d69f7.png" alt="828438bb2270f5d36faaeb1581d65719"></a></p></li> <li><p>在构造器以及实例方法中，<code>对象引用this</code> 都会存放在索引为0的位置</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalVariableTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LocalVariableTest</span> localVariableTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalVariableTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        localVariableTest<span class="token punctuation">.</span><span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><img src="C:\Users\ue\AppData\Roaming\Typora\typora-user-images\image-20210302170349486.png" alt="image-20210302170349486" style="zoom:150%;"> <p><a data-fancybox="" title="image-20210302170531950" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/4808ca296d2c40cf8a2fa6aa6d17bc27.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/4808ca296d2c40cf8a2fa6aa6d17bc27.png" alt="image-20210302170531950"></a></p></li> <li><p>64位的类型（long和double）占用两个slot</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> num2 <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a data-fancybox="" title="image-20210302170707542" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/5bb6f9340b584e428508279e1ee7a57f.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/5bb6f9340b584e428508279e1ee7a57f.png" alt="image-20210302170707542"></a></p> <p><strong>局部变量num2为double类型，索引直接从2跳转到4，说明double类型的变量占据两个slot</strong></p></li> <li><p>static方法无法调用this</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> num2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;def&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a data-fancybox="" title="image-20210302171151962" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/98061b81da3544ef836c28d8c75ffe82.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/98061b81da3544ef836c28d8c75ffe82.png" alt="image-20210302171151962"></a></p></li></ul> <h3 id="_3-3-slot-的重复利用"><a href="#_3-3-slot-的重复利用" class="header-anchor">#</a> 3.3 <code>Slot</code> 的重复利用</h3> <p>栈帧中的局部变量表中的槽位是可以重用的，如果一个局部变量出了其作用域，那么在其作用域之后声明新的局部变量就很有可能会复用过期局部变量的槽位，从而达到节省资源的目的。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        b <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a data-fancybox="" title="image-20210302171709039" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/1dd38b3a69d9447e81663a9b3037f1bf.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/1dd38b3a69d9447e81663a9b3037f1bf.png" alt="image-20210302171709039"></a></p> <p>局部变量 <code>a</code>重用了局部变量 <code>b</code>的slot位置</p> <h2 id="四、操作数栈"><a href="#四、操作数栈" class="header-anchor">#</a> 四、操作数栈</h2> <h3 id="_4-1-操作数栈的特点"><a href="#_4-1-操作数栈的特点" class="header-anchor">#</a> 4.1 操作数栈的特点</h3> <ul><li>每一个独立的栈帧除了包含局部变量表以外，还包含一个后进先出（Last - In - First -Out）的 操作数栈，也可以称之为表达式栈（Expression Stack）</li> <li>操作数栈，在方法执行过程中，根据字节码指令，往栈中写入数据或提取数据，即入栈（push）和 出栈（pop）
<ul><li>某些字节码指令将值压入操作数栈，其余的字节码指令将操作数取出栈。使用它们后再把结果压入栈，比如：执行复制、交换、求和等操作</li></ul></li></ul> <p><a data-fancybox="" title="7c745eaf55f609290a20fab40ca7da9d" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/f6d9ebc98c8142fa8b9bab57e1334a71.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/f6d9ebc98c8142fa8b9bab57e1334a71.png" alt="7c745eaf55f609290a20fab40ca7da9d"></a></p> <h3 id="_4-2-操作数栈的作用"><a href="#_4-2-操作数栈的作用" class="header-anchor">#</a> 4.2 操作数栈的作用</h3> <ul><li><p>操作数栈，主要用于保存计算过程的中间结果，同时作为计算过程中变量临时的存储空间。</p></li> <li><p>操作数栈就是JVM执行引擎的一个工作区，当一个方法刚开始执行的时候，一个新的栈帧也会随之被创建出来，这个时候方法的操作数栈是空的（这个时候数组是创建好并且是长度固定的，但数组的内容为空）</p></li> <li><p>每一个操作数栈都会拥有一个明确的栈深度用于存储数值，其所需的最大深度在编译期就定义好了，保存在方法的Code属性中，为maxstack的值。</p> <p><a data-fancybox="" title="8e2b065c3891ebc246ab3e31068afb49" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/955e6433cc8348c1882d362c01215d33.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/955e6433cc8348c1882d362c01215d33.png" alt="8e2b065c3891ebc246ab3e31068afb49"></a></p></li> <li><p>栈中的任何一个元素都是可以任意的Java数据类型</p> <ul><li><strong>32bit的类型占用一个栈单位深度</strong></li> <li><strong>64bit的类型占用两个栈单位深度</strong></li></ul></li> <li><p>操作数栈<strong>并非采用访问索引的方式来进行数据访问的</strong>，而是只能通过标准的入栈和出栈操作来完成一次数据访问</p></li> <li><p>如果被调用的方法带有返回值的话，其返回值将会被压入当前栈帧的操作数栈中，并更新PC寄存器中下一条需要执行的字节码指令。</p></li> <li><p><strong>操作数栈中元素的数据类型必须与字节码指令的序列严格匹配，这由编译器在编译器期间进行验证</strong>，同时在类加载过程中的类检验阶段的数据流分析阶段要再次验证。</p></li> <li><p>另外，我们说Java虚拟机的<strong>解释引擎是基于栈的执行引擎</strong>，其中的栈指的就是<strong>操作数栈</strong>。</p></li></ul> <h2 id="五、代码追踪"><a href="#五、代码追踪" class="header-anchor">#</a> 五、代码追踪</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAddOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//byte、short、char、boolean：都以int型来保存</span>
    <span class="token keyword">byte</span> i <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> k <span class="token operator">=</span> i <span class="token operator">+</span> j<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token number">0</span> bipush <span class="token number">15</span>
 <span class="token number">2</span> istore_1
 <span class="token number">3</span> bipush <span class="token number">8</span>
 <span class="token number">5</span> istore_2
 <span class="token number">6</span> iload_1
 <span class="token number">7</span> iload_2
 <span class="token number">8</span> iadd
 <span class="token number">9</span> istore_3
<span class="token number">10</span> <span class="token builtin class-name">return</span>
</code></pre></div><p>程序执行流程</p> <ul><li><p>首先执行第一条语句，PC寄存器指向的是0，也就是指令地址为0，然后使用bipush让操作数15入操作数栈。</p> <p><a data-fancybox="" title="b7032b41880b543a6c78d76b0b32be26" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/6cf274dd30b44bc68e90c1d3f4bb1271.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/6cf274dd30b44bc68e90c1d3f4bb1271.png" alt="b7032b41880b543a6c78d76b0b32be26"></a></p></li> <li><p>执行完后，让PC寄存器 + 1，指向下一行代码，下一行代码就是将操作数栈的元素存储到局部变量表索引1的位置，我们可以看到局部变量表的已经增加了一个元素</p></li> <li><p>解释<code>为什么局部变量表索引从 1 开始</code>，因为该方法为<code>实例方法</code>，<code>局部变量表索引为 0 的位置存放的是 this</code></p> <p><a data-fancybox="" title="ddce8c9ae2c7e6f9709d7f9f24b03587" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/65423e3b746e4b91822b34e6a1efa3c5.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/65423e3b746e4b91822b34e6a1efa3c5.png" alt="ddce8c9ae2c7e6f9709d7f9f24b03587"></a></p></li> <li><p>然后PC寄存器+1，指向的是下一行。让操作数8也入栈，同时执行 istore 操作，存入局部变量表中</p> <p><a data-fancybox="" title="bcdd2877b0aaaa0f4ba6f453782317d5" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/523e521bf4db45e6855ee222422665d9.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/523e521bf4db45e6855ee222422665d9.png" alt="bcdd2877b0aaaa0f4ba6f453782317d5"></a></p> <p><a data-fancybox="" title="88c69cfdb9aefb82ae212e38769fb012" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/a139ae8b45d343048274b5a66354b717.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/a139ae8b45d343048274b5a66354b717.png" alt="88c69cfdb9aefb82ae212e38769fb012"></a></p></li> <li><p>将操作数栈的两个元素出栈，执行iadd操作</p></li> <li><p>这里的 iadd 操作具体是：执行引擎将字节码指令翻译成机器指令，然后被CPU进行运算，得出结果，重新放入操作数栈中</p> <p><a data-fancybox="" title="4e2debcd7a75302d01037af073a19055" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/15100903750042ac87b086e216260c9b.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/15100903750042ac87b086e216260c9b.png" alt="4e2debcd7a75302d01037af073a19055"></a></p></li> <li><p>然后执行 istore 操作，将操作数23 存储到局部变量表索引为3的位置</p> <p><a data-fancybox="" title="d6f041a64d11894dd1a2afada522487d" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/6bb8f2a0d43d4e9084b5761d3c12368f.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/6bb8f2a0d43d4e9084b5761d3c12368f.png" alt="d6f041a64d11894dd1a2afada522487d"></a></p></li> <li><blockquote><p>关于 int j =8; 的说明</p></blockquote> <p>我们反编译得到的字节码指令如下</p> <ul><li>因为 8 可以存放在 byte 类型中，所以压入操作数栈的类型为 byte ，而不是 int ，所以执行的字节码指令为 bipush 8</li> <li>然后将数值 8 转换为int类型存储在局部变量表中：istore_2</li></ul> <p><a data-fancybox="" title="c1ac0c1bcd93066d5b2fca7e4ac0b23f" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/1cf9574b8e4648ab8adf74436565357a.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/1cf9574b8e4648ab8adf74436565357a.png" alt="c1ac0c1bcd93066d5b2fca7e4ac0b23f"></a></p> <p>如果被调用的方法带有返回值的话，其返回值将会被压入当前栈帧的操作数栈中</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> k <span class="token operator">=</span> m <span class="token operator">+</span> n<span class="token punctuation">;</span>
    <span class="token keyword">return</span> k<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//获取上一个栈桢返回的结果，并保存在操作数栈中</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a data-fancybox="" title="b96ef7c1a8518306eacd8f31a5a6818d" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/2569d6697fb945018bb15ba8c42bb794.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/2569d6697fb945018bb15ba8c42bb794.png" alt="b96ef7c1a8518306eacd8f31a5a6818d"></a></p> <p><a data-fancybox="" title="0780472d791f86f9980df04ac54431d3" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/3a8c6b83c11f4e288714d4f310afbe44.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/3a8c6b83c11f4e288714d4f310afbe44.png" alt="0780472d791f86f9980df04ac54431d3"></a></p></li> <li><p>面试题：i++ 和 ++i 的区别</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">//程序员面试过程中，常见的 i++ 和 ++i 的区别，放到字节码篇章时再介绍。</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//第1类问题：</span>
    <span class="token keyword">int</span> i1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    i1<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i2<span class="token punctuation">;</span>

    <span class="token comment">//第2类问题：</span>
    <span class="token keyword">int</span> i3 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i4 <span class="token operator">=</span> i3<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i5 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i6 <span class="token operator">=</span> <span class="token operator">++</span>i5<span class="token punctuation">;</span>

    <span class="token comment">//第3类问题：</span>
    <span class="token keyword">int</span> i7 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    i7 <span class="token operator">=</span> i7<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i8 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    i8 <span class="token operator">=</span> <span class="token operator">++</span>i8<span class="token punctuation">;</span>

    <span class="token comment">//第4类问题：</span>
    <span class="token keyword">int</span> i9 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i10 <span class="token operator">=</span> i9<span class="token operator">++</span> <span class="token operator">+</span> <span class="token operator">++</span>i9<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>反编译后的字节码指令</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token number">0</span> bipush <span class="token number">10</span>
 <span class="token number">2</span> istore_1
 <span class="token number">3</span> iinc <span class="token number">1</span> by <span class="token number">1</span>
 <span class="token number">6</span> bipush <span class="token number">10</span>
 <span class="token number">8</span> istore_2
 <span class="token number">9</span> iinc <span class="token number">2</span> by <span class="token number">1</span>
<span class="token number">12</span> bipush <span class="token number">10</span>
<span class="token number">14</span> istore_3
<span class="token number">15</span> iload_3
<span class="token number">16</span> iinc <span class="token number">3</span> by <span class="token number">1</span>
<span class="token number">19</span> istore <span class="token number">4</span>
<span class="token number">21</span> bipush <span class="token number">10</span>
<span class="token number">23</span> istore <span class="token number">5</span>
<span class="token number">25</span> iinc <span class="token number">5</span> by <span class="token number">1</span>
<span class="token number">28</span> iload <span class="token number">5</span>
<span class="token number">30</span> istore <span class="token number">6</span>
<span class="token number">32</span> bipush <span class="token number">10</span>
<span class="token number">34</span> istore <span class="token number">7</span>
<span class="token number">36</span> iload <span class="token number">7</span>
<span class="token number">38</span> iinc <span class="token number">7</span> by <span class="token number">1</span>
<span class="token number">41</span> istore <span class="token number">7</span>
<span class="token number">43</span> bipush <span class="token number">10</span>
<span class="token number">45</span> istore <span class="token number">8</span>
<span class="token number">47</span> iinc <span class="token number">8</span> by <span class="token number">1</span>
<span class="token number">50</span> iload <span class="token number">8</span>
<span class="token number">52</span> istore <span class="token number">8</span>
<span class="token number">54</span> bipush <span class="token number">10</span>
<span class="token number">56</span> istore <span class="token number">9</span>
<span class="token number">58</span> iload <span class="token number">9</span>
<span class="token number">60</span> iinc <span class="token number">9</span> by <span class="token number">1</span>
<span class="token number">63</span> iinc <span class="token number">9</span> by <span class="token number">1</span>
<span class="token number">66</span> iload <span class="token number">9</span>
<span class="token number">68</span> iadd
<span class="token number">69</span> istore <span class="token number">10</span>
<span class="token number">71</span> <span class="token keyword">return</span>
</code></pre></div></li></ul> <h2 id="六、栈顶缓存技术（top-of-stack-caching）"><a href="#六、栈顶缓存技术（top-of-stack-caching）" class="header-anchor">#</a> 六、栈顶缓存技术（Top Of Stack Caching）</h2> <ul><li>前面提过，基于栈式架构的虚拟机所使用的<strong>零地址指令</strong>更加紧凑，但完成一项操作的时候必然需要使用更多的入栈和出栈指令，这同时也就意味着将需要<strong>更多的指令分派（instruction dispatch）次数和内存读/写次数。</strong></li> <li>由于操作数是存储在内存中的，因此频繁地执行内存读/写操作必然会影响执行速度。为了解决这个问题，HotSpot JVM的设计者们提出了栈顶缓存（Tos，Top-of-Stack Cashing）技术，<strong>将栈顶元素全部缓存在物理CPU的寄存器中，以此降低对内存的读/写次数，提升执行引擎的执行效率</strong>。</li> <li>寄存器的主要优点：<strong>指令更少，执行速度快</strong></li></ul> <h2 id="七、动态链接-dynamic-linking"><a href="#七、动态链接-dynamic-linking" class="header-anchor">#</a> 七、动态链接(Dynamic Linking)</h2> <p>动态链接（或指向运行时常量池的方法引用）</p> <p><a data-fancybox="" title="922e70c5bff0f7032c5d9bfc856c9af5" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/9a9812de8b0d49d78bc3204690818488.jpg"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/9a9812de8b0d49d78bc3204690818488.jpg" alt="922e70c5bff0f7032c5d9bfc856c9af5"></a></p> <ul><li>每一个栈帧内部都包含一个指向运行时常量池中该栈帧所属方法的引用</li> <li>包含这个引用的目的就是为了支持当前方法的代码能够实现动态链接（Dynamic Linking），比如：invokedynamic指令</li> <li>在Java源文件被编译到字节码文件中时，所有的变量和方法引用都作为符号引用（Symbolic Reference）保存在class文件的常量池里</li> <li>比如：描述一个方法调用了另外的其他方法时，就是通过常量池中指向方法的符号引用来表示的，那么动态链接的作用就是为了将这些符号引用转换为调用方法的直接引用</li></ul> <p><a data-fancybox="" title="a14a12b342a45ae14439ef00fb19adce" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/af88e5dca1914bee80a1711cb45e5eb9.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/af88e5dca1914bee80a1711cb45e5eb9.png" alt="a14a12b342a45ae14439ef00fb19adce"></a></p> <blockquote><p>在Java源文件被编译到字节码文件中时，所有的变量和方法引用都作为符号引用（Symbolic Reference）保存在class文件的常量池里</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicLinkingTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;methodA()....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;methodB()....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        num<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>在字节码指令中，methodB( ) 方法中通过 <code>invokevirtual #7</code> 指令调用了方法 A</p></li> <li><p>那么 <code>#7</code> 是什么呢？</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Constant pool:
   <span class="token comment">#1 = Methodref          #9.#23         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
   <span class="token comment">#2 = Fieldref           #8.#24         // cn/sxt/java1/DynamicLinkingTest.num:I</span>
   <span class="token comment">#3 = Fieldref           #25.#26        // java/lang/System.out:Ljava/io/PrintStream;</span>
   <span class="token comment">#4 = String             #27            // methodA()....</span>
   <span class="token comment">#5 = Methodref          #28.#29        // java/io/PrintStream.println:(Ljava/lang/String;)V</span>
   <span class="token comment">#6 = String             #30            // methodB()....</span>
   <span class="token comment">#7 = Methodref          #8.#31         // cn/sxt/java1/DynamicLinkingTest.methodA:()V</span>
   <span class="token comment">#8 = Class              #32            // cn/sxt/java1/DynamicLinkingTest</span>
   <span class="token comment">#9 = Class              #33            // java/lang/Object</span>
  <span class="token comment">#10 = Utf8               num</span>
  <span class="token comment">#11 = Utf8               I</span>
  <span class="token comment">#12 = Utf8               &lt;init&gt;</span>
  <span class="token comment">#13 = Utf8               ()V</span>
  <span class="token comment">#14 = Utf8               Code</span>
  <span class="token comment">#15 = Utf8               LineNumberTable</span>
  <span class="token comment">#16 = Utf8               LocalVariableTable</span>
  <span class="token comment">#17 = Utf8               this</span>
  <span class="token comment">#18 = Utf8               Lcn/sxt/java1/DynamicLinkingTest;</span>
  <span class="token comment">#19 = Utf8               methodA</span>
  <span class="token comment">#20 = Utf8               methodB</span>
  <span class="token comment">#21 = Utf8               SourceFile</span>
  <span class="token comment">#22 = Utf8               DynamicLinkingTest.java</span>
  <span class="token comment">#23 = NameAndType        #12:#13        // &quot;&lt;init&gt;&quot;:()V</span>
  <span class="token comment">#24 = NameAndType        #10:#11        // num:I</span>
  <span class="token comment">#25 = Class              #34            // java/lang/System</span>
  <span class="token comment">#26 = NameAndType        #35:#36        // out:Ljava/io/PrintStream;</span>
  <span class="token comment">#27 = Utf8               methodA()....</span>
  <span class="token comment">#28 = Class              #37            // java/io/PrintStream</span>
  <span class="token comment">#29 = NameAndType        #38:#39        // println:(Ljava/lang/String;)V</span>
  <span class="token comment">#30 = Utf8               methodB()....</span>
  <span class="token comment">#31 = NameAndType        #19:#13        // methodA:()V</span>
  <span class="token comment">#32 = Utf8               cn/sxt/java1/DynamicLinkingTest</span>
  <span class="token comment">#33 = Utf8               java/lang/Object</span>
  <span class="token comment">#34 = Utf8               java/lang/System</span>
  <span class="token comment">#35 = Utf8               out</span>
  <span class="token comment">#36 = Utf8               Ljava/io/PrintStream;</span>
  <span class="token comment">#37 = Utf8               java/io/PrintStream</span>
  <span class="token comment">#38 = Utf8               println</span>
  <span class="token comment">#39 = Utf8               (Ljava/lang/String;)V</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> ACC_PUBLIC
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> getstatic     #<span class="token number">3</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
         <span class="token number">3</span><span class="token operator">:</span> ldc           #<span class="token number">6</span>                  <span class="token comment">// String methodB()....</span>
         <span class="token number">5</span><span class="token operator">:</span> invokevirtual #<span class="token number">5</span>                  <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
         <span class="token number">8</span><span class="token operator">:</span> aload_0
         <span class="token number">9</span><span class="token operator">:</span> invokevirtual #<span class="token number">7</span>                  <span class="token comment">// Method methodA:()V</span>
        <span class="token number">12</span><span class="token operator">:</span> aload_0
        <span class="token number">13</span><span class="token operator">:</span> dup
        <span class="token number">14</span><span class="token operator">:</span> getfield      #<span class="token number">2</span>                  <span class="token comment">// Field num:I</span>
        <span class="token number">17</span><span class="token operator">:</span> iconst_1
        <span class="token number">18</span><span class="token operator">:</span> iadd
        <span class="token number">19</span><span class="token operator">:</span> putfield      #<span class="token number">2</span>                  <span class="token comment">// Field num:I</span>
        <span class="token number">22</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">12</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">13</span><span class="token operator">:</span> <span class="token number">8</span>
        line <span class="token number">14</span><span class="token operator">:</span> <span class="token number">12</span>
        line <span class="token number">15</span><span class="token operator">:</span> <span class="token number">22</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">0</span>      <span class="token number">23</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lcn</span><span class="token operator">/</span>sxt<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">DynamicLinkingTest</span><span class="token punctuation">;</span>

</code></pre></div></li> <li><p>往上面翻，找到常量池的定义：#7 = Methodref #8.#31</p></li> <li><p>先找 #8 ：</p> <ul><li>#8 = Class #32 ：去找 #32</li> <li>#32 = Utf8 cn/sxt/java1/DynamicLinkingTest</li></ul></li> <li><p>结论：通过 #8 我们找到了 DynamicLinkingTest 这个类</p></li> <li><p>再来找 #31：</p> <ul><li>#31 = NameAndType #19:#13 ：去找 #19 和 #13</li> <li>#19 = Utf8 methodA ：方法名为 methodA</li> <li>#13 = Utf8 ()V ：方法没有形参，返回值为 void</li></ul></li> <li><p>结论：通过 <code>#7</code> 我们就能找到需要调用的 <code>methodA( ) 方法</code>，并进行调用</p></li></ul> <blockquote><p>为什么要用常量池呢？</p></blockquote> <ul><li>因为在不同的方法，都可能调用常量或者方法，所以<code>只需要存储一份即可，然后记录其引用即可，节省了空间</code></li> <li>常量池的作用：就是为了提供一些符号和常量，便于指令的识别</li></ul> <h2 id="八、方法的调用：解析与分派"><a href="#八、方法的调用：解析与分派" class="header-anchor">#</a> 八、方法的调用：解析与分派</h2> <h3 id="_8-1-静态链接与动态链接"><a href="#_8-1-静态链接与动态链接" class="header-anchor">#</a> 8.1 静态链接与动态链接</h3> <p>在JVM中，将符号引用转换为调用方法的直接引用与方法的绑定机制相关</p> <p><strong>静态链接：</strong>
当一个字节码文件被装载进JVM内部时，如果被调用的目标方法在编译期确定，且运行期保持不变时，这种情况下将调用方法的符号引用转换为直接引用的过程称之为静态链接
<strong>动态链接：</strong>
如果被调用的方法在编译期无法被确定下来，也就是说，只能够在程序运行期将调用的方法的符号转换为直接引用，由于这种引用转换过程具备动态性，因此也被称之为动态链接。</p> <h3 id="_8-2-方法的绑定机制"><a href="#_8-2-方法的绑定机制" class="header-anchor">#</a> 8.2 方法的绑定机制</h3> <p>静态链接和动态链接对应的方法的绑定机制为：早期绑定（Early Binding）和晚期绑定（Late Binding）。绑定是一个字段、方法或者类在符号引用被替换为直接引用的过程，这仅仅发生一次。</p> <ul><li><p><strong>早期绑定</strong>
早期绑定就是指被调用的目标方法如果在编译期可知，且运行期保持不变时，即可将这个方法与所属的类型进行绑定，这样一来，由于明确了被调用的目标方法究竟是哪一个，因此也就可以使用静态链接的方式将符号引用转换为直接引用。</p></li> <li><p><strong>晚期绑定</strong>
如果被调用的方法在编译期无法被确定下来，只能够在程序运行期根据实际的类型绑定相关的方法，这种绑定方式也就被称之为晚期绑定。</p></li> <li><p>随着高级语言的横空出世，类似于Java一样的基于面向对象的编程语言如今越来越多，尽管这类编程语言在语法风格上存在一定的差别，但是它们彼此之间始终保持着一个共性，那就是都支持封装、继承和多态等面向对象特性，既然这一类的编程语言具备多态特性，那么自然也就具备早期绑定和晚期绑定两种绑定方式。</p></li> <li><p>Java中任何一个普通的方法其实都具备虚函数的特征，它们相当于C++语言中的虚函数（C++中则需要使用关键字virtual来显式定义）。如果在Java程序中不希望某个方法拥有虚函数的特征时，则可以使用关键字final来标记这个方法。</p></li> <li><p>举例</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 说明早期绑定和晚期绑定的例子
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;动物进食&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Huntable</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">hunt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token keyword">implements</span> <span class="token class-name">Huntable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;狗吃骨头&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hunt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;捕食耗子，多管闲事&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token keyword">implements</span> <span class="token class-name">Huntable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//表现为：早期绑定</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//表现为：早期绑定</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//表现为：早期绑定</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;猫吃鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hunt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;捕食耗子，天经地义&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showAnimal</span><span class="token punctuation">(</span><span class="token class-name">Animal</span> animal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        animal<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//表现为：晚期绑定</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showHunt</span><span class="token punctuation">(</span><span class="token class-name">Huntable</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        h<span class="token punctuation">.</span><span class="token function">hunt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//表现为：晚期绑定</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a data-fancybox="" title="a796575bdb5b043a4db1b8d492293a82" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/fca7731c7bd24f42856d15b5f3a44167.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/fca7731c7bd24f42856d15b5f3a44167.png" alt="a796575bdb5b043a4db1b8d492293a82"></a></p> <p><a data-fancybox="" title="8e1dfe14d7ecca71e88565f8be076c42" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/559c83fd113a4eb08f9c550a30091124.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/559c83fd113a4eb08f9c550a30091124.png" alt="8e1dfe14d7ecca71e88565f8be076c42"></a></p> <p><a data-fancybox="" title="8a144f94dc04c40d558d2193ae08c319" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/18c4d92b4f54418383fb2736a195a427.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/18c4d92b4f54418383fb2736a195a427.png" alt="8a144f94dc04c40d558d2193ae08c319"></a></p></li></ul> <h3 id="_8-3-虚方法与非虚方法"><a href="#_8-3-虚方法与非虚方法" class="header-anchor">#</a> 8.3 虚方法与非虚方法</h3> <ul><li>如果方法在编译期就确定了具体的调用版本，这个版本在运行时是不可变的。这样的方法称为<code>非虚方法</code>。</li> <li><code>静态方法、私有方法、final 方法、实例构造器、父类方法都是非虚方法</code>。</li> <li>其他方法称为虚方法。</li></ul> <blockquote><p>子类对象的多态性的使用前提</p> <ul><li>类的继承关系</li> <li>方法的重写</li></ul></blockquote> <blockquote><p>虚拟机中调用方法的指令</p> <ol><li><strong>普通调用指令：</strong> <ul><li><strong>invokestatic</strong>：调用静态方法，解析阶段确定唯一方法版本</li> <li><strong>invokespecial</strong>：调用<init>方法、私有及父类方法，解析阶段确定唯一方法版本</init></li> <li><strong>invokevirtual</strong>：调用所有虚方法</li> <li><strong>invokeinterface</strong>：调用接口方法</li></ul></li> <li><strong>动态调用指令：</strong> <ul><li><strong>invokedynamic</strong>：动态解析出需要调用的方法，然后执行</li></ul></li> <li><strong>区别</strong> <ul><li>前四条指令固化在虚拟机内部，方法的调用执行不可人为干预</li> <li>而invokedynamic指令则支持由用户确定方法版本</li> <li><strong>其中invokestatic指令和invokespecial指令调用的方法称为非虚方法</strong>，其余的（final修饰的除外）称为虚方法。</li></ul></li></ol></blockquote> <p>代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 解析调用中非虚方法、虚方法的测试
 *
 * invokestatic指令和invokespecial指令调用的方法称为非虚方法
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;father的构造器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">showStatic</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;father &quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">showFinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;father show final&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showCommon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;father 普通方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//invokespecial 非虚方法</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//invokespecial 非虚方法</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//不是重写的父类的静态方法，因为静态方法不能被重写！</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">showStatic</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;son &quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showPrivate</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;son private&quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//invokestatic 非虚方法</span>
        <span class="token function">showStatic</span><span class="token punctuation">(</span><span class="token string">&quot;baidu.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//invokestatic 非虚方法</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">showStatic</span><span class="token punctuation">(</span><span class="token string">&quot;good!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//invokespecial 非虚方法</span>
        <span class="token function">showPrivate</span><span class="token punctuation">(</span><span class="token string">&quot;hello!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//invokevirtual</span>
        <span class="token comment">//虽然字节码指令中显示为invokevirtual，但因为此方法声明有final，不能被子类重写，所以也认为此方法是非虚方法。</span>
        <span class="token function">showFinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//invokespecial 非虚方法</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">showCommon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//invokevirtual 虚方法</span>
        <span class="token comment">//有可能子类会重写父类的showCommon()方法</span>
        <span class="token function">showCommon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//invokevirtual 虚方法</span>
      	<span class="token comment">//info()是普通方法，有可能被重写，所以是虚方法</span>
        <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">MethodInterface</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">//invokeinterface 虚方法</span>
        in<span class="token punctuation">.</span><span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token class-name">Father</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        f<span class="token punctuation">.</span><span class="token function">showCommon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Son</span> so <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        so<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">MethodInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_8-4-关于invokedynamic指令"><a href="#_8-4-关于invokedynamic指令" class="header-anchor">#</a> 8.4 关于invokedynamic指令</h3> <ul><li>JVM字节码指令集一直比较稳定，一直到Java7中才增加了一个invokedynamic指令，这是Java为了实现【动态类型语言】支持而做的一种改进。</li> <li>但是在Java7中并没有提供直接生成invokedynamic指令的方法，需要借助ASM这种底层字节码工具来产生invokedynamic指令。直到Java8的 Lambda表达式 的出现，invokedynamic指令的生成，在Java中才有了直接的生成方式。</li> <li>Java7中增加的动态语言类型支持的本质是对Java虚拟机规范的修改，而不是对Java语言规则的修改，这一块相对来讲比较复杂，增加了虚拟机中的方法调用，最直接的受益者就是运行在Java平台的动态语言的编译器。</li></ul> <blockquote><p>动态类型语言和静态类型语言</p> <ul><li>动态类型语言和静态类型语言两者的区别就在于对类型的检查是在编译期还是在运行期，满足前者就是静态类型语言，反之是动态类型语言。</li> <li>静态类型语言是判断变量自身的类型信息；动态类型语言是判断变量值的类型信息，变量没有类型信息，变量值才有类型信息，这是动态语言的一个重要特征。</li></ul></blockquote> <blockquote><p>Java语言：String info = &quot;mogu blog&quot;;     		(Java是静态类型语言的，会先编译再进行类型检查)
JS语言：var name = &quot;shkstart&quot;;  var name = 10;	（运行时才进行检查）
Python语言：info = 130.5;  （动态类型语言）</p></blockquote> <p>代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 体会invokedynamic 指令
 */</span>
<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">interface</span> <span class="token class-name">Func</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lambda</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lambda</span><span class="token punctuation">(</span><span class="token class-name">Func</span> func<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Lambda</span> lambda <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Func</span> func <span class="token operator">=</span> s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        lambda<span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>

        lambda<span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><a data-fancybox="" title="809e02b2a4f8774bdf35cc3586c05928" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/284aa23827c446e78bbac5e41fd1d47b.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/284aa23827c446e78bbac5e41fd1d47b.png" alt="809e02b2a4f8774bdf35cc3586c05928"></a></p> <h3 id="_8-5-方法重写的本质"><a href="#_8-5-方法重写的本质" class="header-anchor">#</a> 8.5 方法重写的本质</h3> <blockquote><p>Java语言中方法重写的本质</p> <ul><li>找到操作数栈顶的第一个元素所执行的对象的实际类型，记作C。</li> <li>如果在类型C中找到与常量中的描述符合简单名称都相符的方法，则进行访问权限校验，如果通过则返回这个方法的直接引用，查找过程结束，如果不通过，则返回<code>java.lang.IllegalAccessError</code> 异常</li> <li>否则，按照继承关系从下往上依次对C的各个父类进行第2步的搜索和验证过程。</li> <li>如果始终没有找到合适的方法，则抛出java.lang.AbstractMethodError异常。</li></ul></blockquote> <blockquote><p>IllegalAccessError介绍</p> <ul><li>程序试图访问或修改一个属性或调用一个方法，这个属性或方法，你没有权限访问。</li> <li>一般的，这个会引起编译器异常。这个错误如果发生在运行时，就说明一个类发生了不兼容的改变。</li> <li>比如，你把应该有的jar包放从工程中拿走了，或者Maven中存在jar包冲突</li></ul></blockquote> <h3 id="_8-6-虚方法表"><a href="#_8-6-虚方法表" class="header-anchor">#</a> 8.6 虚方法表</h3> <ul><li>在面向对象的编程中，会很频繁的使用到动态分派，如果在每次动态分派的过程中都要重新在类的方法元数据中搜索合适的目标的话就可能影响到执行效率。</li> <li>因此，为了提高性能，JVM采用在类的方法区建立一个虚方法表（virtual method table）来实现，非虚方法不会出现在表中。使用索引表来代替查找。</li> <li>每个类中都有一个虚方法表，表中存放着各个方法的实际入口。</li> <li>虚方法表是什么时候被创建的呢？ 虚方法表会在类加载的链接阶段被创建并开始初始化，类的变量初始值准备完成之后，JVM会把该类的虚方法表也初始化完毕。</li> <li>如图所示：如果类中重写了方法，那么调用的时候，就会直接在该类的虚方法表中查找</li> <li><a data-fancybox="" title="e297bd7887401445cb098432970d8f9f" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/b42b7c0e7ee241888169f2be1cd59a78.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/b42b7c0e7ee241888169f2be1cd59a78.png" alt="e297bd7887401445cb098432970d8f9f"></a></li></ul> <blockquote><p>回顾解析阶段</p> <ul><li>解析阶段就是将常量池内的符号引用转换为直接引用的过程</li> <li>解析动作主要针对类或接口、字段、类方法、接口方法、方法类型等。对应常量池中的CONSTANT Class info、CONSTANT Fieldref info、CONSTANT Methodref info等</li></ul></blockquote> <blockquote><p>虚方法表举例</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VirtualMethodTable</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Friendly</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">sayGoodbye</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Dog&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">implements</span> <span class="token class-name">Friendly</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayGoodbye</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Cat&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CockerSpaniel</span> <span class="token keyword">extends</span> <span class="token class-name">Dog</span> <span class="token keyword">implements</span> <span class="token class-name">Friendly</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayGoodbye</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><a data-fancybox="" title="20201121222651624" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/2474f6f6bdd94d428b1a75c074c79427.jpeg"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/2474f6f6bdd94d428b1a75c074c79427.jpeg" alt="20201121222651624"></a></p> <p><a data-fancybox="" title="20201121223453844" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/99ca03a0089a462389059a75534b73be.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/99ca03a0089a462389059a75534b73be.png" alt="20201121223453844"></a></p> <p><a data-fancybox="" title="image-20210302204114832" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/8552c729f61943a68ea8c77581b5ffd2.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/8552c729f61943a68ea8c77581b5ffd2.png" alt="image-20210302204114832"></a></p> <h2 id="九、方法返回地址"><a href="#九、方法返回地址" class="header-anchor">#</a> 九、方法返回地址</h2> <ul><li>存放 <strong>调用该方法的pc寄存器的值</strong>。</li> <li>一个方法的结束，有两种方式：
<ul><li>正常执行完成</li> <li>出现未处理的异常，非正常退出</li></ul></li> <li>无论通过哪种方式退出，在方法退出后都返回到该方法被调用的位置。方法正常退出时**，调用者的pc计数器的值作为返回地址，即调用该方法的指令的下一条指令的地址**。而通过异常退出的，返回地址是要通过<strong>异常表</strong>来确定，<strong>栈帧中一般不会保存这部分信息</strong>。</li> <li>本质上，方法的退出就是当前栈帧出栈的过程。此时，需要恢复上层方法的局部变量表、操作数栈、将返回值压入调用者栈帧的操作数栈、设置PC寄存器值等，让调用者方法继续执行下去。</li> <li><strong>正常完成出口和异常完成出口的区别在于：通过异常完成出口退出的不会给他的上层调用者产生任何的返回值。</strong></li></ul> <blockquote><p>方法退出的两种方式</p> <p>当一个方法开始执行后，只有两种方式可以退出这个方法：</p> <ul><li>执行引擎遇到任意一个方法返回的字节码指令（return），会有返回值传递给上层的方法调用者，简称正常完成出口
<ul><li>一个方法在正常调用完成之后，究竟需要使用哪一个返回指令，还需要根据方法返回值的实际数据类型而定。</li> <li>在字节码指令中，返回指令包含：
<ul><li>ireturn：当返回值是boolean，byte，char，short和int类型时使用</li> <li>lreturn：Long类型</li> <li>freturn：Float类型</li> <li>dreturn：Double类型</li> <li>areturn：引用类型</li> <li>return：返回值类型为void的方法、构造器、类和接口的初始化方法</li></ul></li></ul></li> <li>在方法执行过程中遇到异常（Exception），并且这个异常没有在方法内进行处理，也就是只要在本方法的异常表中没有搜索到匹配的异常处理器，就会导致方法退出，简称异常完成出口。
<ul><li>方法执行过程中，抛出异常时的异常处理，存储在一个异常处理表，方便在发生异常的时候找到处理异常的代码</li></ul></li></ul></blockquote> <blockquote><p>异常处理表</p></blockquote> <p><a data-fancybox="" title="20742d9c3f16ca6fdca20f3436d0d2dd" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/c1df479979004f6c8a96e505b34072d8.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/c1df479979004f6c8a96e505b34072d8.png" alt="20742d9c3f16ca6fdca20f3436d0d2dd"></a></p> <ul><li>反编译字节码文件，可得到 Exception table</li> <li>from ：字节码指令起始地址</li> <li>to ：字节码指令结束地址</li> <li>target ：出现异常跳转至地址为 11 的指令执行</li> <li>type ：捕获异常的类型</li></ul> <p>代码:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReturnAddressTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">methodBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span> <span class="token function">methodByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">short</span> <span class="token function">methodShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">char</span> <span class="token function">methodChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">methodInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">methodLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0L</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">methodFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">methodDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">methodString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">methodDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">methodVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileReader</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>cBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>cBuffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a data-fancybox="" title="86d485bbc71a8893d0231e848950bbb0" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/aeca47f012eb44b08d10bb74771701ca.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/aeca47f012eb44b08d10bb74771701ca.png" alt="86d485bbc71a8893d0231e848950bbb0"></a></p> <p><a data-fancybox="" title="23f4206403c5a7d5e86d1d3a642b9c46" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/55274ed420c3425f8f154d9f7ab8b928.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/55274ed420c3425f8f154d9f7ab8b928.png" alt="23f4206403c5a7d5e86d1d3a642b9c46"></a></p> <p><a data-fancybox="" title="155e365dce363666076d3daf1f1a8f86" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/9ca314c0744949a98384a94b8b42103f.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/9ca314c0744949a98384a94b8b42103f.png" alt="155e365dce363666076d3daf1f1a8f86"></a></p> <p><a data-fancybox="" title="401c667f8eb5e6a398b6d2f1c4f372e2" href="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/f61cc84cb3aa4005804350f458e20e0d.png"><img src="http://you-blog.oss-accelerate.aliyuncs.com/typora/2021-03-02/f61cc84cb3aa4005804350f458e20e0d.png" alt="401c667f8eb5e6a398b6d2f1c4f372e2"></a></p> <h2 id="十、关于栈的面试题"><a href="#十、关于栈的面试题" class="header-anchor">#</a> 十、关于栈的面试题</h2> <blockquote><p>举例栈溢出的情况？（StackOverflowError）</p> <ul><li>通过 -Xss 设置栈的大小</li> <li>递归很容易出现栈溢出</li></ul></blockquote> <blockquote><p>调整栈大小，就能保证不出现溢出么？</p> <ul><li>不能保证不出现溢出，只能让栈溢出出现的时间晚一点，不可能不出现</li></ul></blockquote> <blockquote><p>分配的栈内存越大越好么？</p> <ul><li>不是，一定时间内降低了<code>栈溢出</code>的概率，但是会挤占其它的线程空间，因为整个虚拟机的内存空间是有限的</li></ul></blockquote> <blockquote><p>垃圾回收是否涉及到虚拟机栈？</p> <ul><li>不涉及</li></ul></blockquote> <blockquote><p>方法中定义的局部变量是否线程安全？</p> <p>何为线程安全？</p> <ul><li>如果只有一个线程才可以操作此数据，则必是线程安全的。</li> <li>如果有多个线程操作此数据，则此数据是共享数据。如果不考虑同步机制的话，会存在线程安全问题。</li></ul> <p>具体问题具体分析：</p> <ul><li>如果对象是在内部产生，并在内部消亡，没有返回到外部，那么它就是线程安全的，反之则是线程不安全的。</li></ul></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 面试题：
 * 方法中定义的局部变量是否线程安全？具体情况具体分析
 *
 *   何为线程安全？
 *      如果只有一个线程才可以操作此数据，则必是线程安全的。
 *      如果有多个线程操作此数据，则此数据是共享数据。如果不考虑同步机制的话，会存在线程安全问题。
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringBuilderTest</span> <span class="token punctuation">{</span>

    <span class="token comment">//s1的声明方式是线程安全的，因为s1只在方法内部操作，属于局部变量</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//StringBuilder:线程不安全</span>
        <span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//sBuilder通过参数传递方法内，存在线程不安全的问题</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span> sBuilder<span class="token punctuation">)</span><span class="token punctuation">{</span>
        sBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//操作s1之后，将s1作为返回值返回，这样可能被其他线程所调用，所以存在线程不安全的问题</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">StringBuilder</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//s1的操作：是线程安全的，因为String是线程安全的</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">method4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            s<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">method2</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/04_程序计数器.html" class="prev">
        程序计数器
      </a></span> <span class="next"><a href="/blog_publish/java/01_ProgrammingBasic/01_JavaLanguage/02_JVM/06_本地方法接口.html">
        本地方法接口
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog_publish/assets/js/app.5e766715.js" defer></script><script src="/blog_publish/assets/js/2.92f2819f.js" defer></script><script src="/blog_publish/assets/js/33.0eeacbf9.js" defer></script>
  </body>
</html>
